!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).splitio=t()}(this,(function(){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t){var n;if(l(e))for(var r=Object.keys(e),i=0;i<r.length&&!n;i++){var s=r[i];t(e[s],s,e)&&(n=e[s])}else if(Array.isArray(e))for(i=0;i<e.length&&!n;i++){t(e[i],i,e)&&(n=e[i])}return n}function i(e,t){if(Array.isArray(e)&&"function"==typeof t)for(var n=0;n<e.length;n++)if(!0===t(e[n],n,e))return n;return-1}function s(e,t){return Object.keys(e).forEach((function(n){return t(e[n],n,e)})),e}function o(e,t,n){var r=n;try{var i=t.split("."),s=e;i.forEach((function(e){return s=s[e]})),void 0!==s&&(r=s)}catch(e){}return r}function a(e){return!0===e||!1===e}function u(e){return e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&(Number.isFinite?Number.isFinite(e):isFinite(e))}function c(e){return e instanceof Number&&(e=e.valueOf()),e!=e}function l(e){return null!==e&&"object"==typeof e&&(e.constructor===Object||null!=e.constructor&&"Object"===e.constructor.name)}function f(e){return"string"==typeof e||e instanceof String}function h(e){return f(e)?e.toUpperCase():e}function p(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=e;if(l(t)&&Object.keys(t).forEach((function(e){var n=t[e];l(n)&&(n=i[e]&&l(i[e])?p({},i[e],n):p({},n)),void 0!==n&&(i[e]=n)})),n&&n.length){var s=n.splice(0,1)[0];i=p.apply(void 0,function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}([i,s],n,!1))}return i}function g(e,t){return!(!f(e)||!f(t))&&e.slice(0,t.length)===t}function d(e){if("number"==typeof e)return e;if(l(e)&&"function"==typeof e.valueOf){var t=e.valueOf();e=l(t)?t+"":t}return"string"!=typeof e?0===e?e:+e:+(e=e.replace(/^\s+|\s+$/g,""))}function m(e){if(null==e)return"";if("string"==typeof e)return e;if(Array.isArray(e))return e.map((function(e){return f(e)?e:""}))+"";var t=e+"";return"0"===t&&1/e===Number.NEGATIVE_INFINITY?"-0":t}function v(e){var t={};return e.filter((function(e){return!Object.prototype.hasOwnProperty.call(t,e)&&(t[e]=!0)}))}"function"==typeof SuppressedError&&SuppressedError;var y="control",S="IMPRESSION",b="EVENT",E="DEBUG",T="OPTIMIZED",R="NONE",k="localhost",C="standalone",w="producer",N="consumer",_="consumer_partial",A="MEMORY",I="LOCALSTORAGE",O="PLUGGABLE",F="GRANTED",L="DECLINED",D="UNKNOWN",M="getTreatment",K="getTreatments",x="getTreatmentWithConfig",P="getTreatmentsWithConfig",U="getTreatmentsByFlagSet",B="getTreatmentsByFlagSets",j="getTreatmentsWithConfigByFlagSet",q="getTreatmentsWithConfigByFlagSets",z="track",W="split",G="splits",H="names",Q=0,V=1,J=2,Y="sp",$="im",Z="ic",X="ev",ee="te",te="to",ne="se",re="ms",ie="t",se="ts",oe="tc",ae="tcs",ue="tf",ce="tfs",le="tcf",fe="tcfs",he="tr",pe=0,ge=30,de=40,me=50,ve=60,ye=70,Se=80,be=0,Ee=1,Te=1,Re=0,ke=1,Ce=2,we="1.3",Ne="IN_SEGMENT",_e="IN_RULE_BASED_SEGMENT",Ae="standard",Ie="rule-based";function Oe(e){return N===e||_===e}var Fe=0,Le=1,De=2,Me=3,Ke=23,xe=24,Pe=27,Ue=28,Be=29,je=30,qe=31,ze=32,We=33,Ge=35,He=36,Qe=37,Ve=38,Je=39,Ye=40,$e=41,Ze=100,Xe=101,et=102,tt=103,nt=104,rt=105,it=106,st=107,ot=108,at=109,ut=110,ct=111,lt=112,ft=113,ht=114,pt=115,gt=116,dt=117,mt=118,vt=119,yt=120,St=121,bt=122,Et=123,Tt=124,Rt=200,kt=201,Ct=202,wt=203,Nt=204,_t=205,At=206,It=207,Ot=208,Ft=209,Lt=210,Dt=211,Mt=212,Kt=213,xt=214,Pt=215,Ut=216,Bt=217,jt=218,qt=219,zt=220,Wt=221,Gt=222,Ht=223,Qt=224,Vt=225,Jt=226,Yt=227,$t=228,Zt=300,Xt=301,en=302,tn=303,nn=304,rn=305,sn=306,on=307,an=308,un=309,cn=310,ln=311,fn=312,hn=313,pn=314,gn=315,dn=316,mn=317,vn=318,yn=319,Sn=320,bn=321,En=322,Tn=325,Rn=326,kn=327,Cn=328,wn=329,Nn="settings",_n="Factory instantiation",An="Client instantiation",In="engine",On=In+":combiner: ",Fn=In+":matcher: ",Ln=In+":value: ",Dn="sync",Mn=Dn+":sync-manager: ",Kn=Dn+":offline: ",xn=Dn+":streaming: ",Pn=Dn+":featureflag-changes: ",Un=Dn+":my-segments: ",Bn=Dn+":polling-manager: ",jn=Dn+":submitter: ",qn="impressions-tracker: ",zn="events-tracker: ",Wn="unique-keys-tracker: ",Gn="cleanup: ",Hn=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/;function Qn(e,t,n,r){if(void 0===r&&(r="feature flag name"),null==t)e.error(gn,[n,r]);else if(f(t)){if(Hn.test(t)&&(e.warn(xt,[n,r,t]),t=t.trim()),t.length>0)return t;e.error(yn,[n,r])}else e.error(vn,[n,r]);return!1}function Vn(e,t,n,r,i){if(void 0===r&&(r="feature flag names"),void 0===i&&(i="feature flag name"),Array.isArray(t)&&t.length>0){var s=[];if(t.forEach((function(t){var r=Qn(e,t,n,i);r&&s.push(r)})),s.length)return v(s)}return e.error(Sn,[n,r]),!1}var Jn=Object.assign||function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");e=Object(e);for(var t=1;t<arguments.length;t++){var n=Object(arguments[t]);for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Yn=[{type:"bySet",maxLength:50,queryParam:"sets="},{type:"byName",maxLength:400,queryParam:"names="},{type:"byPrefix",maxLength:50,queryParam:"prefixes="}],$n=/^[a-z0-9][_a-z0-9]{0,49}$/,Zn=/[A-Z]/;function Xn(e,t,n){return v(t.map((function(t){return Zn.test(t)&&(e.warn(Jt,[n,t]),t=t.toLowerCase()),t})).filter((function(t){return $n.test(t)?"string"==typeof t:(e.warn(Vt,[n,t,$n,t]),!1)})))}function er(e,t){return r(e,(function(e){return e.type===t&&e.values.length>0}))}function tr(e,t,n){var r,i,s={validFilters:[],queryString:null,groupedFilters:{bySet:[],byName:[],byPrefix:[]}};return t?Oe(n)?(e.warn(qt),s):Array.isArray(t)&&0!==t.length?(s.validFilters=t.filter((function(t,n){return t&&(r=t.type,Yn.some((function(e){return e.type===r})))&&Array.isArray(t.values)?(s.groupedFilters[t.type]=s.groupedFilters[t.type].concat(t.values),!0):(e.warn(zt,[n]),!1);var r})),Yn.forEach((function(t){var n=t.type,r=t.maxLength;s.groupedFilters[n].length>0&&(s.groupedFilters[n]=function(e,t,n,r){var i=Vn(e,n,Nn,t+" filter",t+" filter value");if(i){if("bySet"===t&&(i=Xn(e,i,Nn)),i.length>r)throw new Error(r+" unique values can be specified at most for '"+t+"' filter. You passed "+i.length+". Please consider reducing the amount or using other filter.");i.sort()}return i||[]}(e,n,s.groupedFilters[n],r))})),er(s.validFilters,"bySet")&&((er(s.validFilters,"byName")||er(s.validFilters,"byPrefix"))&&e.error(Cn),Jn(s.groupedFilters,{byName:[],byPrefix:[]})),s.queryString=(r=s.groupedFilters,i=[],Yn.forEach((function(e){var t=e.type,n=e.queryParam,s=r[t];s.length>0&&i.push(n+s.map((function(e){return encodeURIComponent(e)})).join(","))})),i.length>0?"&"+i.join("&"):null),e.debug(Je,[s.queryString]),s):(e.warn(Wt),s):s}var nr,rr=250;function ir(e,t,n,r){if(null==t)return e.error(gn,[n,r]),!1;if(u(t))return e.warn(Kt,[n,r,t]),m(t);if(f(t)){if((t=t.trim()).length>0&&t.length<=rr)return t;0===t.length?e.error(yn,[n,r]):t.length>rr&&e.error(dn,[n,r])}else e.error(vn,[n,r]);return!1}function sr(e,t,n){if(l(t)){var r=ir(e,t.matchingKey,n,"matchingKey"),i=ir(e,t.bucketingKey,n,"bucketingKey");return r&&i?{matchingKey:r,bucketingKey:i}:(e.error(mn,[n]),!1)}return ir(e,t,n,"key")}function or(e,t,n,r){var i=n.splits,s=n.rbSegments,o=n.segments,a=n.largeSegments,u=t.splitChanges,c=u.ff,l=u.rbs;e.debug("storage: set feature flags and segments"+(r?" for key "+r:"")),i&&c&&(i.clear(),i.update(c.d,[],c.t)),s&&l&&(s.clear(),s.update(l.d,[],l.t));var f=t.segmentChanges;if(r){var h=t.memberships&&t.memberships[r];!h&&f&&(h={ms:{k:f.filter((function(e){return e.added.indexOf(r)>-1})).map((function(e){return{n:e.name}}))}}),h&&(h.ms&&o.resetSegments(h.ms),h.ls&&a&&a.resetSegments(h.ls))}else f&&(o.clear(),f.forEach((function(e){o.update(e.name,e.added,e.removed,e.till)})))}!function(e){e.FlagName="Invalid flag name (max 100 chars, no spaces)",e.Treatment="Invalid treatment (max 100 chars and must match pattern)"}(nr||(nr={}));var ar=/^[0-9]+[.a-zA-Z0-9_-]*$|^[a-zA-Z]+[a-zA-Z0-9_-]*$/;function ur(e){var t=l(e)?e.treatment:e;return!(!f(t)||t.length>100)&&ar.test(t)}function cr(e,t){if(void 0!==t){if(ur(t))return t;e.error("Fallback treatments - Discarded fallback: "+nr.Treatment)}}function lr(e,t){var n={};return l(t)?(Object.keys(t).forEach((function(r){var i,s=t[r];(i=r).length<=100&&!i.includes(" ")?ur(s)?n[r]=s:e.error("Fallback treatments - Discarded treatment for flag '"+r+"': "+nr.Treatment):e.error("Fallback treatments - Discarded flag '"+r+"': "+nr.FlagName)})),n):n}var fr={mode:C,core:{authorizationKey:void 0,key:void 0,labelsEnabled:!0,IPAddressesEnabled:void 0},scheduler:{featuresRefreshRate:60,segmentsRefreshRate:60,telemetryRefreshRate:3600,impressionsRefreshRate:300,offlineRefreshRate:15,eventsPushRate:60,eventsQueueSize:500,impressionsQueueSize:3e4,pushRetryBackoffBase:1},urls:{sdk:"https://sdk.split.io/api",events:"https://events.split.io/api",auth:"https://auth.split.io/api",streaming:"https://streaming.split.io",telemetry:"https://telemetry.split.io/api"},storage:void 0,debug:void 0,impressionListener:void 0,version:void 0,integrations:void 0,streamingEnabled:!0,sync:{splitFilters:void 0,impressionsMode:T,enabled:!0,flagSpecVersion:we},log:void 0};function hr(e){return Math.round(1e3*e)}function pr(e,t){var n=t.defaults,r=t.runtime,i=t.storage,s=t.integrations,a=t.logger,u=t.consent,c=t.flagSpec,f=p({},fr,n,e);f.features=o(e,"features");var g=a(f);f.log=g;var d=f.sync;d.impressionsMode=function(e,t){return t=h(t),[E,T,R].indexOf(t)>-1?t:(e.error(bn,["impressionsMode",[E,T,R],T]),T)}(g,d.impressionsMode);var m,v,y,S=f.scheduler,b=f.startup;S.featuresRefreshRate=hr(S.featuresRefreshRate),S.segmentsRefreshRate=hr(S.segmentsRefreshRate),S.offlineRefreshRate=hr(S.offlineRefreshRate),S.eventsPushRate=hr(S.eventsPushRate),S.telemetryRefreshRate=hr((m="telemetryRefreshRate",(v=S.telemetryRefreshRate)>=(y=60)?v:(g.error(Rn,[m,y]),y))),void 0===o(e,"scheduler.impressionsRefreshRate")&&d.impressionsMode===E&&(S.impressionsRefreshRate=60),S.impressionsRefreshRate=hr(S.impressionsRefreshRate),S.metricsRefreshRate&&g.warn("`metricsRefreshRate` will be deprecated soon. For configuring telemetry rates, update `telemetryRefreshRate` value in configs"),b.requestTimeoutBeforeReady=hr(b.requestTimeoutBeforeReady),b.readyTimeout=hr(b.readyTimeout),b.eventsFirstPushWindow=hr(b.eventsFirstPushWindow),f.mode=function(e,t){if("localhost"===e)return k;if(-1===[C,w,N,_].indexOf(t))throw Error("Invalid mode provided");return t}(f.core.authorizationKey,f.mode),i&&(f.storage=i(f)),f.initialRolloutPlan&&(f.initialRolloutPlan=function(e,t){var n=t.mode,r=t.initialRolloutPlan;if(!Oe(n))return l(r)&&l(r.splitChanges)?r:void e.error("storage: invalid rollout plan provided");e.warn("storage: initial rollout plan is ignored in consumer mode")}(g,f));var A=f.core.key;t.acceptKey?f.mode===k&&void 0===A?f.core.key="localhost_key":f.core.key=sr(g,A,An):(void 0!==A&&g.warn("Provided `key` is ignored in server-side SDK."),f.core.key=void 0),f.runtime=r(f),s&&(f.integrations=s(f)),!1!==f.streamingEnabled&&(f.streamingEnabled=!0,S.pushRetryBackoffBase=hr(S.pushRetryBackoffBase)),!1!==d.enabled&&(d.enabled=!0);var I=tr(g,d.splitFilters,f.mode);return d.splitFilters=I.validFilters,d.__splitFiltersValidation=I,d.flagSpecVersion=c?c(f):we,f.userConsent=u?u(f):void 0,f.fallbackTreatments=f.fallbackTreatments?function(e,t){if(l(t))return{global:cr(e,t.global),byFlag:lr(e,t.byFlag)};e.error("Fallback treatments - Discarded configuration: it must be an object with optional `global` and `byFlag` properties")}(g,f.fallbackTreatments):void 0,f}function gr(e){return null!==e&&"object"==typeof e&&"function"==typeof e.debug&&"function"==typeof e.info&&"function"==typeof e.warn&&"function"==typeof e.error}var dr={DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR",NONE:"NONE"},mr={DEBUG:1,INFO:2,WARN:3,ERROR:4,NONE:5},vr={debug:function(e){console.log("[DEBUG] "+e)},info:function(e){console.log("[INFO]  "+e)},warn:function(e){console.log("[WARN]  "+e)},error:function(e){console.log("[ERROR] "+e)}};function yr(e){return!!r(dr,(function(t){return e===t}))}function Sr(e,t){void 0===e&&(e=""),void 0===t&&(t=[]);var n=0;return e.replace(/%s/g,(function(){var e=t[n++];if(l(e)||Array.isArray(e))try{e=JSON.stringify(e)}catch(e){}return e}))}var br,Er={prefix:"splitio",logLevel:dr.NONE},Tr=function(){function e(e,t){this.options=Jn({},Er,e),this.codes=t||new Map,this.logLevel=mr[this.options.logLevel]}return e.prototype.setLogLevel=function(e){this.options.logLevel=e,this.logLevel=mr[e]},e.prototype.setLogger=function(e){if(e){if(gr(e))return void(this.logger=e);this.error("Invalid `logger` instance. It must be an object with `debug`, `info`, `warn` and `error` methods. Defaulting to `console.log`")}this.logger=void 0},e.prototype.debug=function(e,t){this._shouldLog(mr.DEBUG)&&this._log("debug",e,t)},e.prototype.info=function(e,t){this._shouldLog(mr.INFO)&&this._log("info",e,t)},e.prototype.warn=function(e,t){this._shouldLog(mr.WARN)&&this._log("warn",e,t)},e.prototype.error=function(e,t){this._shouldLog(mr.ERROR)&&this._log("error",e,t)},e.prototype._log=function(e,t,n){if("number"==typeof t){var r=this.codes.get(t);t=r?Sr(r,n):"Message code "+t+(n?", with args: "+n.toString():"")}else n&&(t=Sr(t,n));if(this.options.prefix&&(t=this.options.prefix+" => "+t),this.logger)try{return void this.logger[e](t)}catch(e){}vr[e](t)},e.prototype._shouldLog=function(e){return e>=this.logLevel},e}();try{var Rr=localStorage.getItem("splitio_debug")||"";br=/^(enabled?|on)/i.test(Rr)?dr.DEBUG:yr(Rr)?Rr:dr.NONE}catch(Ti){}var kr={startup:{requestTimeoutBeforeReady:5,retriesOnFailureBeforeReady:1,readyTimeout:10,eventsFirstPushWindow:10},userConsent:F,version:"browserjs-1.6.1",debug:br};var Cr=function(){function e(){}return e.prototype.update=function(e,t,n){var r=this,i=e.map((function(e){return r.addSplit(e)})).some((function(e){return e}));return i=t.map((function(e){return r.removeSplit(e.name)})).some((function(e){return e}))||i,this.setChangeNumber(n),i},e.prototype.getSplits=function(e){var t=this,n={};return e.forEach((function(e){n[e]=t.getSplit(e)})),n},e.prototype.getAll=function(){var e=this;return this.getSplitNames().map((function(t){return e.getSplit(t)}))},e.prototype.killLocally=function(e,t,n){var r=this.getSplit(e);if(r&&(!r.changeNumber||r.changeNumber<n)){var i=Jn({},r);return i.killed=!0,i.defaultTreatment=t,i.changeNumber=n,this.addSplit(i)}return!1},e}();function wr(e){for(var t=e.conditions||[],n=0;n<t.length;n++)for(var r=t[n].matcherGroup.matchers,i=0;i<r.length;i++){var s=r[i].matcherType;if(s===Ne||"IN_LARGE_SEGMENT"===s)return!0}var o=e.excluded;return!!(o&&o.segments&&o.segments.length>0)}function Nr(e){return e.splits.usesSegments()||e.rbSegments.usesSegments()}var _r=function(e){function n(t){var n=e.call(this)||this;return n.splitsCache={},n.ttCache={},n.changeNumber=-1,n.segmentsCount=0,n.flagSetsCache={},n.flagSetsFilter=t?t.groupedFilters.bySet:[],n}return t(n,e),n.prototype.clear=function(){this.splitsCache={},this.ttCache={},this.changeNumber=-1,this.segmentsCount=0,this.flagSetsCache={}},n.prototype.addSplit=function(e){var t=e.name,n=this.getSplit(t);if(n){var r=n.trafficTypeName;this.ttCache[r]--,this.ttCache[r]||delete this.ttCache[r],this.removeFromFlagSets(n.name,n.sets),wr(n)&&this.segmentsCount--}this.splitsCache[t]=e;var i=e.trafficTypeName;return this.ttCache[i]=(this.ttCache[i]||0)+1,this.addToFlagSets(e),wr(e)&&this.segmentsCount++,!0},n.prototype.removeSplit=function(e){var t=this.getSplit(e);if(!t)return!1;delete this.splitsCache[e];var n=t.trafficTypeName;return this.ttCache[n]--,this.ttCache[n]||delete this.ttCache[n],this.removeFromFlagSets(t.name,t.sets),wr(t)&&this.segmentsCount--,!0},n.prototype.getSplit=function(e){return this.splitsCache[e]||null},n.prototype.setChangeNumber=function(e){return this.changeNumber=e,!0},n.prototype.getChangeNumber=function(){return this.changeNumber},n.prototype.getSplitNames=function(){return Object.keys(this.splitsCache)},n.prototype.trafficTypeExists=function(e){return u(this.ttCache[e])&&this.ttCache[e]>0},n.prototype.usesSegments=function(){return-1===this.getChangeNumber()||this.segmentsCount>0},n.prototype.getNamesByFlagSets=function(e){var t=this;return e.map((function(e){return t.flagSetsCache[e]||new Set}))},n.prototype.addToFlagSets=function(e){var t=this;e.sets&&e.sets.forEach((function(n){t.flagSetsFilter.length>0&&!t.flagSetsFilter.some((function(e){return e===n}))||(t.flagSetsCache[n]||(t.flagSetsCache[n]=new Set([])),t.flagSetsCache[n].add(e.name))}))},n.prototype.removeFromFlagSets=function(e,t){var n=this;t&&t.forEach((function(t){n.removeNames(t,e)}))},n.prototype.removeNames=function(e,t){this.flagSetsCache[e]&&(this.flagSetsCache[e].delete(t),0===this.flagSetsCache[e].size&&delete this.flagSetsCache[e])},n}(Cr),Ar=function(){function e(){}return e.prototype.clear=function(){this.resetSegments({})},e.prototype.registerSegments=function(){return!1},e.prototype.update=function(){return!1},e.prototype.resetSegments=function(e){var t=this,n=!1,r=e,i=r.added,s=r.removed;if(i&&s)i.forEach((function(e){n=t.addSegment(e)||n})),s.forEach((function(e){n=t.removeSegment(e)||n}));else{var o=(e.k||[]).map((function(e){return e.n})).sort(),a=this.getRegisteredSegments().sort();if(o.length||a.length){for(var u=0;u<o.length&&u<a.length&&o[u]===a[u];)u++;if(u===o.length&&u===a.length)n=!1;else{for(var c=u;c<a.length;c++)this.removeSegment(a[c]);for(var l=u;l<o.length;l++)this.addSegment(o[l]);n=!0}}else n=!1}return this.setChangeNumber(e.cn),n},e}(),Ir=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.segmentCache={},t}return t(n,e),n.prototype.addSegment=function(e){return!this.segmentCache[e]&&(this.segmentCache[e]=!0,!0)},n.prototype.removeSegment=function(e){return!!this.segmentCache[e]&&(delete this.segmentCache[e],!0)},n.prototype.isInSegment=function(e){return!0===this.segmentCache[e]},n.prototype.setChangeNumber=function(e){this.cn=e},n.prototype.getChangeNumber=function(){return this.cn||-1},n.prototype.getRegisteredSegments=function(){return Object.keys(this.segmentCache)},n.prototype.getKeysCount=function(){return 1},n}(Ar),Or=function(){function e(e){void 0===e&&(e=0),this.name="impressions",this.maxQueue=e,this.queue=[]}return e.prototype.setOnFullQueueCb=function(e){this.onFullQueue=e},e.prototype.track=function(e){var t;(t=this.queue).push.apply(t,e),this.maxQueue>0&&this.queue.length>=this.maxQueue&&this.onFullQueue&&this.onFullQueue()},e.prototype.clear=function(){this.queue=[]},e.prototype.pop=function(e){var t=this.queue;return this.clear(),e?e.concat(t):t},e.prototype.isEmpty=function(){return 0===this.queue.length},e}(),Fr=function(){function e(e){void 0===e&&(e=0),this.name="events",this.maxQueue=e,this.queue=[],this.queueByteSize=0}return e.prototype.setOnFullQueueCb=function(e){this.onFullQueue=e},e.prototype.track=function(e,t){return void 0===t&&(t=0),this.queueByteSize+=t,this.queue.push(e),this._checkForFlush(),!0},e.prototype.clear=function(){this.queue=[],this.queueByteSize=0},e.prototype.pop=function(e){var t=this.queue;return this.clear(),e?e.concat(t):t},e.prototype.isEmpty=function(){return 0===this.queue.length},e.prototype._checkForFlush=function(){(this.queueByteSize>5242880||this.maxQueue>0&&this.queue.length>=this.maxQueue)&&this.onFullQueue&&this.onFullQueue()},e}(),Lr=36e5;function Dr(e){return e-e%Lr}var Mr=function(){function e(e){void 0===e&&(e=3e4),this.name="impression counts",this.cache={},this.cacheSize=0,this.maxStorage=e}return e.prototype._makeKey=function(e,t){return e+"::"+Dr(t)},e.prototype.track=function(e,t,n){var r=this._makeKey(e,t),i=this.cache[r];this.cache[r]=i?i+n:n,this.onFullQueue&&(this.cacheSize=this.cacheSize+n,this.cacheSize>=this.maxStorage&&this.onFullQueue())},e.prototype.pop=function(e){var t=this.cache;return this.clear(),e?(Object.keys(t).forEach((function(n){e[n]?e[n]+=t[n]:e[n]=t[n]})),e):t},e.prototype.clear=function(){this.cache={},this.cacheSize=0},e.prototype.isEmpty=function(){return 0===Object.keys(this.cache).length},e}();function Kr(e){return l(e)?e.matchingKey:e}function xr(e){return l(e)?{matchingKey:e.matchingKey,bucketingKey:e.bucketingKey}:{matchingKey:e,bucketingKey:e}}function Pr(e){return!e.core.key}function Ur(e){var t=Math.min(22,Math.max(0,Math.ceil(Math.log(e)/Math.log(1.5))));return c(t)?0:t}var Br=.001;function jr(e){var t=e.settings;return t.mode!==k&&(Pr(t)||Math.random()<=Br)}var qr=function(){function e(e,t,n){this.splits=e,this.segments=t,this.largeSegments=n,this.name="telemetry stats",this.e=!0,this.notReadyUsage=0,this.impressionStats=[0,0,0],this.eventStats=[0,0],this.lastSync={},this.httpErrors={},this.httpLatencies={},this.authRejections=0,this.tokenRefreshes=0,this.streamingEvents=[],this.tags=[],this.exceptions={},this.latencies={},this.updatesFromSSE={}}return e.prototype.isEmpty=function(){return this.e},e.prototype.clear=function(){},e.prototype.pop=function(){return this.e=!0,{lS:this.getLastSynchronization(),mL:this.popLatencies(),mE:this.popExceptions(),hE:this.popHttpErrors(),hL:this.popHttpLatencies(),tR:this.popTokenRefreshes(),aR:this.popAuthRejections(),iQ:this.getImpressionStats(Q),iDe:this.getImpressionStats(J),iDr:this.getImpressionStats(V),spC:this.splits&&this.splits.getSplitNames().length,seC:this.segments&&this.segments.getRegisteredSegments().length,skC:this.segments&&this.segments.getKeysCount(),lsC:this.largeSegments&&this.largeSegments.getRegisteredSegments().length,lskC:this.largeSegments&&this.largeSegments.getKeysCount(),sL:this.getSessionLength(),eQ:this.getEventStats(Q),eD:this.getEventStats(V),sE:this.popStreamingEvents(),t:this.popTags(),ufs:this.popUpdatesFromSSE()}},e.prototype.getTimeUntilReady=function(){return this.timeUntilReady},e.prototype.recordTimeUntilReady=function(e){this.timeUntilReady=e},e.prototype.getTimeUntilReadyFromCache=function(){return this.timeUntilReadyFromCache},e.prototype.recordTimeUntilReadyFromCache=function(e){this.timeUntilReadyFromCache=e},e.prototype.getNonReadyUsage=function(){return this.notReadyUsage},e.prototype.recordNonReadyUsage=function(){this.notReadyUsage++},e.prototype.getImpressionStats=function(e){return this.impressionStats[e]},e.prototype.recordImpressionStats=function(e,t){this.impressionStats[e]+=t,this.e=!1},e.prototype.getEventStats=function(e){return this.eventStats[e]},e.prototype.recordEventStats=function(e,t){this.eventStats[e]+=t,this.e=!1},e.prototype.getLastSynchronization=function(){return this.lastSync},e.prototype.recordSuccessfulSync=function(e,t){this.lastSync[e]=t,this.e=!1},e.prototype.popHttpErrors=function(){var e=this.httpErrors;return this.httpErrors={},e},e.prototype.recordHttpError=function(e,t){var n=this.httpErrors[e]=this.httpErrors[e]||{};n[t]=(n[t]||0)+1,this.e=!1},e.prototype.popHttpLatencies=function(){var e=this.httpLatencies;return this.httpLatencies={},e},e.prototype.recordHttpLatency=function(e,t){(this.httpLatencies[e]=this.httpLatencies[e]||[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])[Ur(t)]++,this.e=!1},e.prototype.popAuthRejections=function(){var e=this.authRejections;return this.authRejections=0,e},e.prototype.recordAuthRejections=function(){this.authRejections++,this.e=!1},e.prototype.popTokenRefreshes=function(){var e=this.tokenRefreshes;return this.tokenRefreshes=0,e},e.prototype.recordTokenRefreshes=function(){this.tokenRefreshes++,this.e=!1},e.prototype.popStreamingEvents=function(){return this.streamingEvents.splice(0)},e.prototype.recordStreamingEvents=function(e){this.streamingEvents.length<20&&this.streamingEvents.push(e),this.e=!1},e.prototype.popTags=function(){return this.tags.splice(0)},e.prototype.addTag=function(e){this.tags.length<10&&this.tags.push(e),this.e=!1},e.prototype.getSessionLength=function(){return this.sessionLength},e.prototype.recordSessionLength=function(e){this.sessionLength=e,this.e=!1},e.prototype.popExceptions=function(){var e=this.exceptions;return this.exceptions={},e},e.prototype.recordException=function(e){this.exceptions[e]=(this.exceptions[e]||0)+1,this.e=!1},e.prototype.popLatencies=function(){var e=this.latencies;return this.latencies={},e},e.prototype.recordLatency=function(e,t){(this.latencies[e]=this.latencies[e]||[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])[Ur(t)]++,this.e=!1},e.prototype.popUpdatesFromSSE=function(){var e=this.updatesFromSSE;return this.updatesFromSSE={},e},e.prototype.recordUpdatesFromSSE=function(e){this.updatesFromSSE[e]=(this.updatesFromSSE[e]||0)+1,this.e=!1},e}();function zr(e){if(Array.from)return Array.from(e);var t=[];return e.forEach((function(e){t.push(e)})),t}var Wr=function(){function e(e){void 0===e&&(e=3e4),this.name="unique keys",this.uniqueTrackerSize=0,this.uniqueKeysTracker={},this.maxStorage=e}return e.prototype.setOnFullQueueCb=function(e){this.onFullQueue=e},e.prototype.track=function(e,t){this.uniqueKeysTracker[e]||(this.uniqueKeysTracker[e]=new Set);var n=this.uniqueKeysTracker[e];n.has(t)||(n.add(t),this.uniqueTrackerSize++),this.uniqueTrackerSize>=this.maxStorage&&this.onFullQueue&&this.onFullQueue()},e.prototype.clear=function(){this.uniqueTrackerSize=0,this.uniqueKeysTracker={}},e.prototype.pop=function(){var e=this.uniqueKeysTracker;return this.clear(),this.fromUniqueKeysCollector(e)},e.prototype.isEmpty=function(){return 0===Object.keys(this.uniqueKeysTracker).length},e.prototype.fromUniqueKeysCollector=function(e){for(var t=[],n=Object.keys(e),r=0;r<n.length;r++){var i=n[r],s={k:i,fs:zr(e[i])};t.push(s)}return{keys:t}},e}(),Gr=function(){function e(){this.cache={},this.changeNumber=-1,this.segmentsCount=0}return e.prototype.clear=function(){this.cache={},this.changeNumber=-1,this.segmentsCount=0},e.prototype.update=function(e,t,n){var r=this,i=e.map((function(e){return r.add(e)})).some((function(e){return e}));return i=t.map((function(e){return r.remove(e.name)})).some((function(e){return e}))||i,this.changeNumber=n,i},e.prototype.add=function(e){var t=e.name,n=this.get(t);return n&&wr(n)&&this.segmentsCount--,this.cache[t]=e,wr(e)&&this.segmentsCount++,!0},e.prototype.remove=function(e){var t=this.get(e);return!!t&&(delete this.cache[e],wr(t)&&this.segmentsCount--,!0)},e.prototype.getNames=function(){return Object.keys(this.cache)},e.prototype.get=function(e){return this.cache[e]||null},e.prototype.getAll=function(){var e=this;return this.getNames().map((function(t){return e.get(t)}))},e.prototype.contains=function(e){var t=zr(e),n=this.getNames();return t.every((function(e){return-1!==n.indexOf(e)}))},e.prototype.getChangeNumber=function(){return this.changeNumber},e.prototype.usesSegments=function(){return this.segmentsCount>0},e}();function Hr(e){var t=e.settings,n=t.scheduler,r=n.impressionsQueueSize,i=n.eventsQueueSize,s=t.sync.__splitFiltersValidation,o=new _r(s),a=new Gr,u=new Ir,c={splits:o,rbSegments:a,segments:u,largeSegments:new Ir,impressions:new Or(r),impressionCounts:new Mr,events:new Fr(i),telemetry:jr(e)?new qr(o,u):void 0,uniqueKeys:new Wr,destroy:function(){},shared:function(){return{splits:this.splits,rbSegments:this.rbSegments,segments:new Ir,largeSegments:new Ir,impressions:this.impressions,impressionCounts:this.impressionCounts,events:this.events,telemetry:this.telemetry,uniqueKeys:this.uniqueKeys,destroy:function(){}}}};if(e.settings.mode===k){var l=function(){return!0};c.impressions.track=l,c.events.track=l,c.impressionCounts.track=l,c.uniqueKeys.track=l}return c}function Qr(e){var t=Hr(e);return t.validateCache=function(){return Promise.resolve(!0)},t}Hr.type=A,Qr.type=A;var Vr=dr.NONE;var Jr=[L,F,D];var Yr={defaults:kr,acceptKey:!0,runtime:function(){return{ip:!1,hostname:!1}},storage:function(e){var t=e.storage,n=void 0===t?Hr:t,r=e.log,i=e.mode;if("function"==typeof n&&-1!==[A,I,O].indexOf(n.type)||(n=Hr,r.error(324)),i===k&&n.type===I)return Qr;if(-1===[k,C].indexOf(i)){if(n.type!==O)throw new Error("A PluggableStorage instance is required on consumer mode")}else n.type===O&&(n=Hr,r.error(324,[" It requires consumer mode."]));return n},integrations:function(e){return function(e,t,n){var r=e.integrations,i=e.log;if(!Array.isArray(r)||0===r.length)return[];var s=r.filter(t),o=r.length-s.length;return o&&i.warn(jt,[o,n||""]),s}(e,(function(e){return"function"==typeof e}),"Integration items must be functions that initialize the integrations")},logger:function(e){var t,n=e.debug,r=e.logger,i=Vr;if(void 0!==n){if(function(e){return gr(e)&&"function"==typeof e.setLogLevel}(n))return n.setLogger(r),n;i="boolean"==typeof(t=e.debug)?t?dr.DEBUG:dr.NONE:"string"==typeof t&&yr(t)?t:void 0}var s=new Tr({logLevel:i||Vr});return s.setLogger(r),i||s._log("error","Invalid `debug` value at config. Logs will be disabled."),s},consent:function(e){var t=e.userConsent,n=e.log;return t=h(t),Jr.indexOf(t)>-1?t:(n.error(bn,["userConsent",Jr,F]),F)}};var $r=new Set(["splitsdkclientkey","splitsdkversion","splitsdkmachineip","splitsdkmachinename","splitsdkimpressionsmode","host","referrer","content-type","content-length","content-encoding","accept","keep-alive","x-fastly-debug"]);function Zr(e,t){var n;if(null===(n=e.sync.requestOptions)||void 0===n?void 0:n.getHeaderOverrides)try{var r=e.sync.requestOptions.getHeaderOverrides({headers:Jn({},t)});Object.keys(r).filter((function(e){return!$r.has(e.toLowerCase())})).forEach((function(e){return t[e]=r[e]}))}catch(t){e.log.error("Problem adding custom headers to request decorator: "+t)}return t}function Xr(e,t){return e<1?t:new Promise((function(n,r){var i=setTimeout((function(){r(new Error("Operation timed out because it exceeded the configured time limit of "+e+" ms."))}),e);t.then((function(e){clearTimeout(i),n(e)}),(function(e){clearTimeout(i),r(e)}))}))}var ei=100,ti="Global fetch API is not available.";var ni={headers:{"Cache-Control":"no-cache"}};function ri(e){return"users="+encodeURIComponent(e)}function ii(e,t,n){var r=e.urls,i=e.sync.__splitFiltersValidation&&e.sync.__splitFiltersValidation.queryString,s=e.sync.impressionsMode,o=function(e,t){var n=t.getOptions,r=t.getFetch,i=e.log,s=e.core.authorizationKey,o=e.version,a=e.runtime,u=a.ip,c=a.hostname,l=n&&n(e),f=r&&r(e);f||i.error(tn,[ti]);var h={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s,SplitSDKVersion:o};return u&&(h.SplitSDKMachineIP=u),c&&(h.SplitSDKMachineName=c.replace(/[^\x00-\xFF]/g,"")),function(t,n,r,s){void 0===n&&(n={}),void 0===r&&(r=function(){}),void 0===s&&(s=!1);var o=Jn({headers:Zr(e,Jn({},h,n.headers||{})),method:n.method||"GET",body:n.body},l);return f?f(t,o).then((function(e){return e.ok?(r(),e):Xr(ei,e.text()).then((function(t){return Promise.reject({response:e,message:t})}),(function(){return Promise.reject({response:e})}))})).catch((function(e){var n=e&&e.response,o="";o=n?404===n.status?"Invalid SDK key or resource not found.":e.message:e.message||"Network Error",n&&403===n.status||i[s?"info":"error"](En,[n?"status code "+n.status:"no status code",t,o]);var a=new Error(o);throw a.statusCode=n&&n.status,r(a),a})):Promise.reject(new Error(ti))}}(e,t);return{getSdkAPIHealthCheck:function(){var e=r.sdk+"/version";return o(e).then((function(){return!0})).catch((function(){return!1}))},getEventsAPIHealthCheck:function(){var e=r.events+"/version";return o(e).then((function(){return!0})).catch((function(){return!1}))},fetchAuth:function(t){var i=r.auth+"/v2/auth?s="+e.sync.flagSpecVersion;if(t){var s=t.map(ri).join("&");s&&(i+="&"+s)}return o(i,void 0,n.trackHttp(te))},fetchSplitChanges:function(t,s,a,u){var c=r.sdk+"/splitChanges?s="+e.sync.flagSpecVersion+"&since="+t+(u?"&rbSince="+u:"")+(i||"")+(a?"&till="+a:"");return o(c,s?ni:void 0,n.trackHttp(Y)).catch((function(t){throw 414===t.statusCode&&e.log.error(kn),t}))},fetchSegmentChanges:function(e,t,i,s){var a=r.sdk+"/segmentChanges/"+t+"?since="+e+(s?"&till="+s:"");return o(a,i?ni:void 0,n.trackHttp(ne))},fetchMemberships:function(e,t,i){var s=r.sdk+"/memberships/"+encodeURIComponent(e)+(i?"?till="+i:"");return o(s,t?ni:void 0,n.trackHttp(re))},postEventsBulk:function(e,t){var i=r.events+"/events/bulk";return o(i,{method:"POST",body:e,headers:t},n.trackHttp(X))},postTestImpressionsBulk:function(e,t){var i=r.events+"/testImpressions/bulk";return o(i,{method:"POST",body:e,headers:Jn({SplitSDKImpressionsMode:s},t)},n.trackHttp($))},postTestImpressionsCount:function(e,t){var i=r.events+"/testImpressions/count";return o(i,{method:"POST",body:e,headers:t},n.trackHttp(Z))},postUniqueKeysBulkCs:function(e,t){var i=r.telemetry+"/v1/keys/cs";return o(i,{method:"POST",body:e,headers:t},n.trackHttp(ee))},postUniqueKeysBulkSs:function(e,t){var i=r.telemetry+"/v1/keys/ss";return o(i,{method:"POST",body:e,headers:t},n.trackHttp(ee))},postMetricsConfig:function(e,t){var i=r.telemetry+"/v1/metrics/config";return o(i,{method:"POST",body:e,headers:t},n.trackHttp(ee),!0)},postMetricsUsage:function(e,t){var i=r.telemetry+"/v1/metrics/usage";return o(i,{method:"POST",body:e,headers:t},n.trackHttp(ee),!0)}}}function si(e,t,n,r){void 0===r&&(r="task");var i,s,o,a=0,u=!1,c=0;function l(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];return a++,e.debug(Qe,[r]),i=(i?i.then((function(){return t.apply(void 0,n)})):t.apply(void 0,n)).then((function(e){return a--,e}))}function f(e){return l.apply(void 0,s).then((function(t){return u&&e===c&&(o=setTimeout(f,n,e)),t}))}return{execute:l,isExecuting:function(){return a>0},start:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];if(!u)return u=!0,c++,s=t,e.debug(He,[r,n]),f(c)},stop:function(){u&&(u=!1,e.debug(Ve,[r]),clearTimeout(o),o=void 0)},isRunning:function(){return u}}}function oi(e,t,n,r,i,s,o){void 0===s&&(s=0);var a,u=n.name,c=0;return si(e,(function(){if(n.isEmpty()&&!a)return Promise.resolve();var r="number"==typeof(a=n.pop(a)).length?a.length+" "+u:u;e[o?"debug":"info"](gt,[r]);var l=JSON.stringify(i?i(a):a);return s||(a=void 0),t(l).then((function(){c=0,a=void 0})).catch((function(t){s?c===s?(c=0,a=void 0,e[o?"debug":"warn"](Ft,[r,t])):(c++,e[o?"debug":"warn"](Lt,[r,t])):e[o?"debug":"warn"](Ft,[r,t])}))}),r,u+" submitter")}function ai(e,t){var n,r=!1,i=e.start;e.start=function(){r=!0,n=setTimeout(i,t)};var s=e.stop;return e.stop=function(){r=!1,clearTimeout(n),s()},e.isRunning=function(){return r},e}function ui(e){var t=e.settings,n=t.log,r=t.scheduler.eventsPushRate,i=t.startup.eventsFirstPushWindow,s=e.splitApi.postEventsBulk,o=e.storage.events,a=oi(n,s,o,r);return i>0&&(a=ai(a,i)),o.setOnFullQueueCb((function(){a.isRunning()&&(n.info(pt,[o.name]),a.execute())})),a}function ci(e,t){var n=function(e,t){var n={};if(Array.isArray(e)&&f(t))for(var r=0;r<e.length;r++){var i=e[r][t];f(i)&&(n[i]||(n[i]=[]),n[i].push(e[r]))}return n}(t,"feature"),r=[];return s(n,(function(t,n){r.push({f:n,i:t.map((function(t){return{k:t.keyName,t:t.treatment,m:t.time,c:t.changeNumber,r:e?t.label:void 0,b:t.bucketingKey,pt:t.pt,properties:t.properties}}))})})),r}function li(e){var t=e.settings,n=t.log,r=t.scheduler.impressionsRefreshRate,i=t.core.labelsEnabled,s=e.splitApi.postTestImpressionsBulk,o=e.storage.impressions,a=oi(n,s,o,r,ci.bind(void 0,i),1);return o.setOnFullQueueCb((function(){a.isRunning()&&(n.info(pt,[o.name]),a.execute())})),a}function fi(e){for(var t=[],n=Object.keys(e),r=0;r<n.length;r++){var i=n[r].split("::");if(2===i.length){var s=i[0],o=i[1],a={f:s,m:Number(o),rc:e[n[r]]};t.push(a)}}return{pf:t}}var hi=18e5;function pi(e){return oi(e.settings.log,e.splitApi.postTestImpressionsCount,e.storage.impressionCounts,hi,fi,1)}var gi="state::splits-arrived",di="state::splits-cache-loaded",mi="state::segments-arrived",vi="init::timeout",yi="init::ready",Si="init::cache-ready",bi="state::update",Ei="sdk_key";var Ti,Ri,ki,Ci={};function wi(e,t){var n=function(e,t){var n=!1;return null==t?e.error(gn,[_n,Ei]):f(t)?t.length>0?n=t:e.error(yn,[_n,Ei]):e.error(vn,[_n,Ei]),n}(e,t);return n&&(Ci[n]?(e.warn(Gt,[Ci[n]+" factory/ies with this SDK Key"]),Ci[n]++):(Ci[n]=1,Object.keys(Ci).length>1&&e.warn(Gt,["an instance of the Split factory"]))),n}function Ni(e){var t=e();return function(){return Math.round(e()-t)}}var _i=((Ti={})[C]=0,Ti[N]=1,Ti[_]=2,Ti),Ai=((Ri={})[T]=0,Ri[E]=1,Ri[R]=2,Ri),Ii=((ki={})[D]=1,ki[F]=2,ki[L]=3,ki);function Oi(e,t){return{name:"telemetry config",isEmpty:function(){return!1},clear:function(){},pop:function(){var n,r,i=t.urls,s=t.scheduler,o=Pr(t),a=function(e){var t=0;e.validFilters.forEach((function(e){"bySet"===e.type&&(t+=e.values.length)}));var n=e.groupedFilters.bySet.length;return{flagSetsTotal:t,flagSetsIgnored:t-n}}(t.sync.__splitFiltersValidation),u=a.flagSetsTotal,c=a.flagSetsIgnored;return Jn((n=t.mode,r=t.storage.type,{oM:_i[n],st:r.toLowerCase(),aF:Object.keys(Ci).length,rF:Object.keys(Ci).reduce((function(e,t){return e+Ci[t]-1}),0)}),{sE:t.streamingEnabled,rR:{sp:s.featuresRefreshRate/1e3,se:o?s.segmentsRefreshRate/1e3:void 0,ms:o?void 0:s.segmentsRefreshRate/1e3,im:s.impressionsRefreshRate/1e3,ev:s.eventsPushRate/1e3,te:s.telemetryRefreshRate/1e3},uO:{s:i.sdk!==fr.urls.sdk,e:i.events!==fr.urls.events,a:i.auth!==fr.urls.auth,st:i.streaming!==fr.urls.streaming,t:i.telemetry!==fr.urls.telemetry},iQ:s.impressionsQueueSize,eQ:s.eventsQueueSize,iM:Ai[t.sync.impressionsMode],iL:!!t.impressionListener,hP:!1,tR:e.getTimeUntilReady(),tC:e.getTimeUntilReadyFromCache(),nR:e.getNonReadyUsage(),t:e.popTags(),i:t.integrations&&t.integrations.map((function(e){return e.type})),uC:t.userConsent?Ii[t.userConsent]:0,fsT:u,fsI:c})}}}var Fi=9e5;function Li(e){var t=e.settings,n=t.log,r=t.core.key,i=e.splitApi,s=i.postUniqueKeysBulkCs,o=i.postUniqueKeysBulkSs,a=e.storage.uniqueKeys,u=oi(n,void 0!==r?s:o,a,Fi);return a.setOnFullQueueCb((function(){u.isRunning()&&(n.info(pt,[a.name]),u.execute())})),u}function Di(e){var t=[li(e),ui(e),pi(e),Li(e)],n=function(e){var t=e.storage.telemetry,n=e.platform.now;if(t&&n){var r=e.settings,i=e.settings,s=i.log,o=i.scheduler.telemetryRefreshRate,a=e.splitApi,u=e.readiness,c=e.sdkReadinessManager,l=Ni(n),f=ai(oi(s,a.postMetricsUsage,t,o,void 0,0,!0),o);return u.gate.once(Si,(function(){t.recordTimeUntilReadyFromCache(l())})),c.incInternalReadyCbCount(),u.gate.once(yi,(function(){t.recordTimeUntilReady(l()),f.isRunning()&&oi(s,a.postMetricsConfig,Oi(t,r),0,void 0,0,!0).execute()})),f}}(e);return{start:function(e){e||t.forEach((function(e){return e.start()})),n&&n.start()},stop:function(e){t.forEach((function(e){return e.stop()})),!e&&n&&n.stop()},isRunning:function(){return t.some((function(e){return e.isRunning()}))},execute:function(e){var r=e?[]:t.map((function(e){return e.execute()}));return n&&r.push(n.execute()),Promise.all(r)},isExecuting:function(){return t.some((function(e){return e.isExecuting()}))}}}var Mi,Ki=600,xi="PUSH_NONRETRYABLE_ERROR",Pi="PUSH_RETRYABLE_ERROR",Ui="PUSH_SUBSYSTEM_UP",Bi="PUSH_SUBSYSTEM_DOWN",ji="MEMBERSHIPS_MS_UPDATE",qi="MEMBERSHIPS_LS_UPDATE",zi="SEGMENT_UPDATE",Wi="SPLIT_KILL",Gi="SPLIT_UPDATE",Hi="RB_SEGMENT_UPDATE",Qi="CONTROL",Vi="OCCUPANCY";function Ji(e){var t=e.userConsent;return!t||t===F}function Yi(e,t){return function(n){var r=n.settings,i=n.settings,s=i.log,o=i.streamingEnabled,a=i.sync.enabled,u=n.telemetryTracker,c=n.storage,l=n.readiness,f=e&&e(n),h=a&&o&&f&&t?t(n,f):void 0,p=Di(n);h&&(h.on(Ui,(function(){s.info(vt),f.isRunning()&&(f.stop(),u.streamingEvent(ye,be)),f.syncAll()})),h.on(Bi,(function(){f.isRunning()?s.info(mt):(s.info(dt),f.start(),u.streamingEvent(ye,Ee))})));var g=!1,d=!0;return{pollingManager:f,pushManager:h,submitterManager:p,start:function(){return g=!0,p.start(!Ji(r)),Promise.resolve(!!c.validateCache&&c.validateCache()).then((function(e){g&&(d&&e&&l.splits.emit(di),f&&(a?h?(d&&f.syncAll(),h.start()):f.start():d&&f.syncAll()),d=!1)}))},stop:function(){g=!1,h&&h.stop(),f&&f.isRunning()&&f.stop(),p.stop()},isRunning:function(){return g},flush:function(){return p.execute(!Ji(r))},shared:function(e,t,n){if(f){var r=f.add(e,t,n);return a&&h&&h.add(e,r),g&&(a?h?f.isRunning()?Nr(n)&&r.start():r.execute():Nr(n)&&r.start():t.isReady()||r.execute()),{stop:function(){var t=f.get(e);t&&(h&&h.remove(e),t.isRunning()&&t.stop(),f.remove(e))},flush:function(){return Promise.resolve()}}}}}}}!function(e){e.STREAMING_DISABLED="STREAMING_DISABLED",e.STREAMING_PAUSED="STREAMING_PAUSED",e.STREAMING_RESUMED="STREAMING_RESUMED",e.STREAMING_RESET="STREAMING_RESET"}(Mi||(Mi={}));var $i=function(){function e(t,n,r){this.baseMillis=e.__TEST__BASE_MILLIS||n||e.DEFAULT_BASE_MILLIS,this.maxMillis=e.__TEST__MAX_MILLIS||r||e.DEFAULT_MAX_MILLIS,this.attempts=0,this.cb=t}return e.prototype.scheduleCall=function(){var e=this,t=Math.min(this.baseMillis*Math.pow(2,this.attempts),this.maxMillis);return this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=setTimeout((function(){e.timeoutID=void 0,e.cb()}),t),this.attempts++,t},e.prototype.reset=function(){this.attempts=0,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=void 0)},e.DEFAULT_BASE_MILLIS=1e3,e.DEFAULT_MAX_MILLIS=18e5,e}();var Zi=[/control_pri$/,/control_sec$/],Xi=[10,20];function es(e,t,n){var r=function(e,t){var n=Zi.map((function(e){return{regex:e,hasPublishers:!0,oTime:-1,cTime:-1}})),r=!0,i=!0;return{handleOpen:function(){t.streamingEvent(pe),e.emit(Ui)},isStreamingUp:function(){return i&&r},handleOccupancyEvent:function(s,o,a){for(var u=0;u<n.length;u++){var c=n[u];if(c.regex.test(o)){if(t.streamingEvent(Xi[u],s),a>c.oTime){c.oTime=a,c.hasPublishers=0!==s;var l=n.some((function(e){return e.hasPublishers}));i&&(!l&&r?e.emit(Bi):l&&!r&&e.emit(Ui)),r=l}return}}},handleControlEvent:function(s,o,a){if(s!==Mi.STREAMING_RESET)for(var u=0;u<n.length;u++){var c=n[u];if(c.regex.test(o))return void(a>c.cTime&&(c.cTime=a,s===Mi.STREAMING_DISABLED?(t.streamingEvent(ge,Re),e.emit(xi)):r&&(s===Mi.STREAMING_PAUSED&&i?(t.streamingEvent(ge,Ce),e.emit(Bi)):s!==Mi.STREAMING_RESUMED||i||(t.streamingEvent(ge,ke),e.emit(Ui))),i=s===Mi.STREAMING_RESUMED))}else e.emit(s)}}}(t,n);return{handleOpen:function(){r.handleOpen()},handleError:function(r){var i=r;try{i=function(e){return f(e.data)&&(e.parsedData=JSON.parse(e.data)),e}(r)}catch(t){e.warn(At,[t])}var s=i.parsedData&&i.parsedData.message||i.message;e.error(rn,[s]),!function(e){if(e.parsedData&&e.parsedData.code){var t=e.parsedData.code;if(n.streamingEvent(ve,t),40140<=t&&t<=40149)return!0;if(4e4<=t&&t<=49999)return!1}else n.streamingEvent(de,Te);return!0}(i)?t.emit(xi):t.emit(Pi)},handleMessage:function(n){var i;try{if(i=function(e){if(e.data){var t=JSON.parse(e.data);return t.parsedData=JSON.parse(t.data),t.name&&"[meta]occupancy"===t.name&&(t.parsedData.type=Vi),t}}(n),!i)return}catch(t){return void e.warn(It,[t])}var s=i.parsedData,o=i.data,a=i.channel,u=i.timestamp;if(e.debug(Ge,[o]),r.isStreamingUp()||-1!==[Vi,Qi].indexOf(s.type))switch(s.type){case Gi:case zi:case ji:case qi:case Wi:case Hi:t.emit(s.type,s);break;case Vi:r.handleOccupancyEvent(s.metrics.publishers,a,u);break;case Qi:r.handleControlEvent(s.controlType,a,u)}}}}var ts=1e4,ns=6e4,rs=10;function is(e,t,n,r){var i,s,o;function a(t){var i,a,u,c=0,l=-1,f=!1,h=new $i(p);function p(){if(i=!0,c>Math.max(l,t.getChangeNumber())){f=!1;var g=c;(s?new Promise((function(e){o=setTimeout((function(){s=void 0,n.execute(u,!0,a?c:void 0).then(e)}),s)})):n.execute(u,!0,a?c:void 0)).then((function(n){if(i){if(!1!==n){var s=t.getChangeNumber();l=s>-1?s:Math.max(l,g)}if(f)p();else{u&&r.trackUpdatesFromSSE(re);var o=h.attempts+1;if(c<=l)return e.debug("Refresh completed"+(a?" bypassing the CDN":"")+" in "+o+" attempts."),void(i=!1);if(o<rs)return void h.scheduleCall();a?(e.debug("No changes fetched after "+o+" attempts with CDN bypassed."),i=!1):(h.reset(),a=!0,p())}}}))}else i=!1}return{put:function(e,n,r){var o=e.type,g=e.cn;g<=Math.max(l,t.getChangeNumber())||g<=c||(c=g,s||(f=!0,a=!1,u=n&&{type:o,cn:g,added:n.added,removed:n.removed},s=r,!h.timeoutID&&i||p(),h.reset()))},stop:function(){clearTimeout(o),s=void 0,i=!1,h.reset()}}}var u=((i={})[ji]=a(t.segments),i[qi]=a(t.largeSegments),i);return{put:function(e,t,n){u[e.type].put(e,t,n)},stop:function(){u[ji].stop(),u[qi].stop()}}}function ss(e,t,n){var r={};return{put:function(i){var s=i.changeNumber,o=i.segmentName;r[o]||(r[o]=function(r){var i,s,o=0,a=!1,u=new $i(c,ts,ns);function c(){i=!0,o>(n.getChangeNumber(r)||-1)?(a=!1,t.execute(!1,r,!0,s?o:void 0).then((function(){if(i)if(a)c();else{var t=u.attempts+1;if(o<=(n.getChangeNumber(r)||-1))return e.debug("Refresh completed"+(s?" bypassing the CDN":"")+" in "+t+" attempts."),void(i=!1);if(t<rs)return void u.scheduleCall();s?(e.debug("No changes fetched after "+t+" attempts with CDN bypassed."),i=!1):(u.reset(),s=!0,c())}}))):i=!1}return{put:function(e){e<=(n.getChangeNumber(r)||-1)||e<=o||(o=e,a=!0,s=!1,!u.timeoutID&&i||c(),u.reset())},stop:function(){i=!1,u.reset()}}}(o)),r[o].put(s)},stop:function(){Object.keys(r).forEach((function(e){return r[e].stop()}))}}}var os=function(){if([typeof Uint8Array,typeof Uint16Array,typeof Uint32Array].some((function(e){return"function"!=e})))return"global Uint8Array object is not available for gzip/zlib decompression";var e=Uint8Array,t=Uint16Array,n=Uint32Array,r=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),s=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(e,r){for(var i=new t(31),s=0;s<31;++s)i[s]=r+=1<<e[s-1];var o=new n(i[30]);for(s=1;s<30;++s)for(var a=i[s];a<i[s+1];++a)o[a]=a-i[s]<<5|s;return[i,o]},a=o(r,2),u=a[0],c=a[1];u[28]=258,c[258]=28;for(var l=o(i,0)[0],f=new t(32768),h=0;h<32768;++h){var p=(43690&h)>>>1|(21845&h)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,f[h]=((65280&p)>>>8|(255&p)<<8)>>>1}var g=function(e,n,r){for(var i=e.length,s=0,o=new t(n);s<i;++s)++o[e[s]-1];var a,u=new t(n);for(s=0;s<n;++s)u[s]=u[s-1]+o[s-1]<<1;if(r){a=new t(1<<n);var c=15-n;for(s=0;s<i;++s)if(e[s])for(var l=s<<4|e[s],h=n-e[s],p=u[e[s]-1]++<<h,g=p|(1<<h)-1;p<=g;++p)a[f[p]>>>c]=l}else for(a=new t(i),s=0;s<i;++s)e[s]&&(a[s]=f[u[e[s]-1]++]>>>15-e[s]);return a},d=new e(288);for(h=0;h<144;++h)d[h]=8;for(h=144;h<256;++h)d[h]=9;for(h=256;h<280;++h)d[h]=7;for(h=280;h<288;++h)d[h]=8;var m=new e(32);for(h=0;h<32;++h)m[h]=5;var v=g(d,9,1),y=g(m,5,1),S=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},b=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},E=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},T=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],R=function(e,t,n){var r=new Error(t||T[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,R),!n)throw r;return r},k=function(o,a,c){var f=o.length;if(!f||c&&c.f&&!c.l)return a||new e(0);var h=!a||c,p=!c||c.i;c||(c={}),a||(a=new e(3*f));var d=function(t){var n=a.length;if(t>n){var r=new e(Math.max(2*n,t));r.set(a),a=r}},m=c.f||0,T=c.p||0,k=c.b||0,C=c.l,w=c.d,N=c.m,_=c.n,A=8*f;do{if(!C){m=b(o,T,1);var I=b(o,T+1,3);if(T+=3,!I){var O=o[(q=4+((T+7)/8|0))-4]|o[q-3]<<8,F=q+O;if(F>f){p&&R(0);break}h&&d(k+O),a.set(o.subarray(q,F),k),c.b=k+=O,c.p=T=8*F,c.f=m;continue}if(1==I)C=v,w=y,N=9,_=5;else if(2==I){var L=b(o,T,31)+257,D=b(o,T+10,15)+4,M=L+b(o,T+5,31)+1;T+=14;for(var K=new e(M),x=new e(19),P=0;P<D;++P)x[s[P]]=b(o,T+3*P,7);T+=3*D;var U=S(x),B=(1<<U)-1,j=g(x,U,1);for(P=0;P<M;){var q,z=j[b(o,T,B)];if(T+=15&z,(q=z>>>4)<16)K[P++]=q;else{var W=0,G=0;for(16==q?(G=3+b(o,T,3),T+=2,W=K[P-1]):17==q?(G=3+b(o,T,7),T+=3):18==q&&(G=11+b(o,T,127),T+=7);G--;)K[P++]=W}}var H=K.subarray(0,L),Q=K.subarray(L);N=S(H),_=S(Q),C=g(H,N,1),w=g(Q,_,1)}else R(1);if(T>A){p&&R(0);break}}h&&d(k+131072);for(var V=(1<<N)-1,J=(1<<_)-1,Y=T;;Y=T){var $=(W=C[E(o,T)&V])>>>4;if((T+=15&W)>A){p&&R(0);break}if(W||R(2),$<256)a[k++]=$;else{if(256==$){Y=T,C=null;break}var Z=$-254;if($>264){var X=r[P=$-257];Z=b(o,T,(1<<X)-1)+u[P],T+=X}var ee=w[E(o,T)&J],te=ee>>>4;ee||R(3),T+=15&ee;Q=l[te];if(te>3){X=i[te];Q+=E(o,T)&(1<<X)-1,T+=X}if(T>A){p&&R(0);break}h&&d(k+131072);for(var ne=k+Z;k<ne;k+=4)a[k]=a[k-Q],a[k+1]=a[k+1-Q],a[k+2]=a[k+2-Q],a[k+3]=a[k+3-Q];k=ne}}c.l=C,c.p=Y,c.b=k,c.f=m,C&&(m=1,c.m=N,c.d=w,c.n=_)}while(!m);return k==a.length?a:function(r,i,s){(null==i||i<0)&&(i=0),(null==s||s>r.length)&&(s=r.length);var o=new(r instanceof t?t:r instanceof n?n:e)(s-i);return o.set(r.subarray(i,s)),o}(a,0,k)};return{gunzipSync:function(t,n){return k(t.subarray(function(e){31==e[0]&&139==e[1]&&8==e[2]||R(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)}(t),-8),n||new e((i=(r=t).length,(r[i-4]|r[i-3]<<8|r[i-2]<<16|r[i-1]<<24)>>>0)));var r,i},unzlibSync:function(e,t){return k(((8!=(15&(n=e)[0])||n[0]>>>4>7||(n[0]<<8|n[1])%31)&&R(6,"invalid zlib data"),32&n[1]&&R(6,"invalid zlib data: preset dictionaries not supported"),e.subarray(2,-4)),t);var n}}}(),as="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function us(e){var t=String(e).replace(/[=]+$/,"");if(t.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var n="",r=0,i=void 0,s=void 0,o=0;s=t.charAt(o++);~s&&(i=r%4?64*i+s:s,r++%4)?n+=String.fromCharCode(255&i>>(-2*r&6)):0)s=as.indexOf(s);return n}var cs=String.fromCharCode;function ls(e){var t,n,r,i,s;return n=function(e){if("string"!=typeof e)throw TypeError("Illegal argument: "+typeof e);var t=0;return function(){return t>=e.length?null:e.charCodeAt(t++)}}(e),i=[],s=[],r=t=function(){if(0===arguments.length)return s.join("")+cs.apply(String,i);i.length+arguments.length>1024&&(s.push(cs.apply(String,i)),i.length=0),Array.prototype.push.apply(i,arguments)},function(e,t){for(var n,r=null;null!==(n=null!==r?r:e());)n>=55296&&n<=57343&&null!==(r=e())&&r>=56320&&r<=57343?(t(1024*(n-55296)+r-56320+65536),r=null):t(n);null!==r&&t(r)}(n,(function(e){!function(e,t){var n=null;for("number"==typeof e&&(n=e,e=function(){return null});null!==n||null!==(n=e());)n<128?t(127&n):n<2048?(t(n>>6&31|192),t(63&n|128)):n<65536?(t(n>>12&15|224),t(n>>6&63|128),t(63&n|128)):(t(n>>18&7|240),t(n>>12&63|128),t(n>>6&63|128),t(63&n|128)),n=null}(e,r)})),t()}
/*!
   * +----------------------------------------------------------------------------------+
   * | murmurHash3.js v3.0.0 (http://github.com/karanlyons/murmurHash3.js)              |
   * | A TypeScript/JavaScript implementation of MurmurHash3's hashing algorithms.      |
   * |----------------------------------------------------------------------------------|
   * | Copyright (c) 2012-2020 Karan Lyons. Freely distributable under the MIT license. |
   * +----------------------------------------------------------------------------------+
   */function fs(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function hs(e,t){return e<<t|e>>>32-t}function ps(e,t){t=t||0;for(var n,r=(e=e||"").length%4,i=e.length-r,s=t,o=0,a=3432918353,u=461845907,c=0;c<i;c+=4)o=fs(o=255&e.charCodeAt(c)|(255&e.charCodeAt(c+1))<<8|(255&e.charCodeAt(c+2))<<16|(255&e.charCodeAt(c+3))<<24,a),o=fs(o=hs(o,15),u),s=fs(s=hs(s^=o,13),5)+3864292196;switch(o=0,r){case 3:o^=(255&e.charCodeAt(c+2))<<16;case 2:o^=(255&e.charCodeAt(c+1))<<8;case 1:o=fs(o^=255&e.charCodeAt(c),a),s^=o=fs(o=hs(o,15),u)}return s^=e.length,n=s,n=fs(n^=n>>>16,2246822507),(s=(n=fs(n^=n>>>13,3266489909))^n>>>16)>>>0}function gs(e,t){return ps(ls(e),t>>>0)}function ds(e,t){return Math.abs(gs(e,t)%100)+1}var ms=1,vs=2;function ys(e,t){var n,r=us(e),i=(n=r.split("").map((function(e){return e.charCodeAt(0)})),new Uint8Array(n));if("string"==typeof os)throw new Error(os);if(t===ms)return os.gunzipSync(i);if(t===vs)return os.unzlibSync(i);throw new Error("Invalid compression algorithm #"+t)}function Ss(e,t,n){void 0===n&&(n=!0);var r,i=ys(e,t),s=(r=i,String.fromCharCode.apply(null,r));return n&&(s=s.replace(/\d+/g,'"$&"')),JSON.parse(s)}var bs=6e4;function Es(e,t){if(0===e.h)return 0;var n=e.i||bs;return gs(t,e.s||0)%n}function Ts(e,t,n,r,i,s){var o=u(t.splits),a=u(t.rbSegments);function u(t){var r,u,c,l=-1,f=!1,h=new $i(p,ts,ns);function p(){r=!0,l>t.getChangeNumber()?(f=!1,n.execute(!0,u?l:void 0,c).then((function(){if(r)if(f)p();else{c&&i.trackUpdatesFromSSE(Y),s&&s.execute(!0);var t=h.attempts+1;if(o.isSync()&&a.isSync())return e.debug("Refresh completed"+(u?" bypassing the CDN":"")+" in "+t+" attempts."),void(r=!1);if(t<rs)return void h.scheduleCall();u?(e.debug("No changes fetched after "+t+" attempts with CDN bypassed."),r=!1):(h.reset(),u=!0,p())}}))):r=!1}return{put:function(e,n){var i=e.changeNumber,s=e.pcn,o=e.type,a=t.getChangeNumber();i<=a||i<=l||(l=i,f=!0,u=!1,c=void 0,n&&a===s&&(c={payload:n,changeNumber:i,type:o}),!h.timeoutID&&r||p(),h.reset())},stop:function(){r=!1,h.reset()},isSync:function(){return l<=t.getChangeNumber()}}}return{put:function(t){if(t.d&&void 0!==t.c)try{var n=(r=t.c,i=t.d,r>0?Ss(i,r,!1):JSON.parse(us(i)));if(n)return void(t.type===Hi?a:o).put(t,n)}catch(n){e.warn(Qt,[t.type,n])}var r,i;(t.type===Hi?a:o).put(t)},killSplit:function(e){var n=e.changeNumber,i=e.splitName,s=e.defaultTreatment;t.splits.killLocally(i,s,n)&&r.emit(gi,!0),o.put({changeNumber:n})},stop:function(){o.stop(),a.stop()}}}function Rs(e){return function(t){return e(t).then((function(e){return e.json()})).then((function(e){if(e.token){var t=(r=e.token,i=r.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(us(i).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("")),JSON.parse(s));if("number"!=typeof t.iat||"number"!=typeof t.exp)throw new Error('token properties "issuedAt" (iat) or "expiration" (exp) are missing or invalid');var n=JSON.parse(t["x-ably-capability"]);return Jn({decodedToken:t,channels:n},e)}var r,i,s;return e}))}}function ks(e){return function(e){for(var t=String(e),n="",r=void 0,i=void 0,s=0,o=as;t.charAt(0|s)||(o="=",s%1);n+=o.charAt(63&r>>8-s%1*8)){if((i=t.charCodeAt(s+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");r=r<<8|i}return n}(gs(e,0).toString())}var Cs=/^control_/;var ws,Ns,_s=function(){function e(e,t){var n=t.getEventSource,r=t.getOptions;if(this.settings=e,this.eventSource=n&&n(e),!this.eventSource)throw new Error("EventSource API is not available.");this.headers=function(e){var t={SplitSDKClientKey:f(e.core.authorizationKey)?e.core.authorizationKey.slice(-4):"",SplitSDKVersion:e.version},n=e.runtime,r=n.ip,i=n.hostname;return r&&(t.SplitSDKMachineIP=r),i&&(t.SplitSDKMachineName=i),t}(e),this.options=r&&r(e)}return e.prototype.setEventHandler=function(e){this.handler=e},e.prototype.open=function(e){var t;this.close();var n=Object.keys(e.channels).map((function(e){var t=Cs.test(e)?"[?occupancy=metrics.publishers]":"";return encodeURIComponent(t+e)})).join(","),r=this.settings.urls.streaming+"/sse?channels="+n+"&accessToken="+e.token+"&v=1.1&heartbeats=true",i=Pr(this.settings);this.connection=new this.eventSource(i?r:r+"&SplitSDKVersion="+this.headers.SplitSDKVersion+"&SplitSDKClientKey="+this.headers.SplitSDKClientKey,Jn(i?{headers:Zr(this.settings,this.headers)}:(null===(t=this.settings.sync.requestOptions)||void 0===t?void 0:t.getHeaderOverrides)?{headers:Zr(this.settings,{})}:{},this.options)),this.handler&&(this.connection.addEventListener("open",this.handler.handleOpen),this.connection.addEventListener("message",this.handler.handleMessage),this.connection.addEventListener("error",this.handler.handleError))},e.prototype.close=function(){this.connection&&this.connection.close()},e}();function As(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]+t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]+t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]+t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]+t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function Is(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]*t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]*t[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=e[3]*t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]*t[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[2]*t[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[3]*t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function Os(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function Fs(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function Ls(e,t){return[e[0]^t[0],e[1]^t[1]]}function Ds(e){return e=Ls(e,[0,e[0]>>>1]),e=Ls(e=Is(e,[4283543511,3981806797]),[0,e[0]>>>1]),e=Ls(e=Is(e,[3301882366,444984403]),[0,e[0]>>>1])}function Ms(e,t){return function(e,t){t=t||0;for(var n=(e=e||"").length%16,r=e.length-n,i=[0,t],s=[0,t],o=[0,0],a=[0,0],u=[2277735313,289559509],c=[1291169091,658871167],l=0;l<r;l+=16)o=[255&e.charCodeAt(l+4)|(255&e.charCodeAt(l+5))<<8|(255&e.charCodeAt(l+6))<<16|(255&e.charCodeAt(l+7))<<24,255&e.charCodeAt(l)|(255&e.charCodeAt(l+1))<<8|(255&e.charCodeAt(l+2))<<16|(255&e.charCodeAt(l+3))<<24],a=[255&e.charCodeAt(l+12)|(255&e.charCodeAt(l+13))<<8|(255&e.charCodeAt(l+14))<<16|(255&e.charCodeAt(l+15))<<24,255&e.charCodeAt(l+8)|(255&e.charCodeAt(l+9))<<8|(255&e.charCodeAt(l+10))<<16|(255&e.charCodeAt(l+11))<<24],o=Os(o=Is(o,u),31),i=As(i=Os(i=Ls(i,o=Is(o,c)),27),s),i=As(Is(i,[0,5]),[0,1390208809]),a=Os(a=Is(a,c),33),s=As(s=Os(s=Ls(s,a=Is(a,u)),31),i),s=As(Is(s,[0,5]),[0,944331445]);switch(o=[0,0],a=[0,0],n){case 15:a=Ls(a,Fs([0,e.charCodeAt(l+14)],48));case 14:a=Ls(a,Fs([0,e.charCodeAt(l+13)],40));case 13:a=Ls(a,Fs([0,e.charCodeAt(l+12)],32));case 12:a=Ls(a,Fs([0,e.charCodeAt(l+11)],24));case 11:a=Ls(a,Fs([0,e.charCodeAt(l+10)],16));case 10:a=Ls(a,Fs([0,e.charCodeAt(l+9)],8));case 9:a=Is(a=Ls(a,[0,e.charCodeAt(l+8)]),c),s=Ls(s,a=Is(a=Os(a,33),u));case 8:o=Ls(o,Fs([0,e.charCodeAt(l+7)],56));case 7:o=Ls(o,Fs([0,e.charCodeAt(l+6)],48));case 6:o=Ls(o,Fs([0,e.charCodeAt(l+5)],40));case 5:o=Ls(o,Fs([0,e.charCodeAt(l+4)],32));case 4:o=Ls(o,Fs([0,e.charCodeAt(l+3)],24));case 3:o=Ls(o,Fs([0,e.charCodeAt(l+2)],16));case 2:o=Ls(o,Fs([0,e.charCodeAt(l+1)],8));case 1:o=Is(o=Ls(o,[0,e.charCodeAt(l)]),u),i=Ls(i,o=Is(o=Os(o,31),c))}return i=As(i=Ls(i,[0,e.length]),s=Ls(s,[0,e.length])),s=As(s,i),i=As(i=Ds(i),s=Ds(s)),s=As(s,i),("00000000"+(i[0]>>>0).toString(16)).slice(-8)+("00000000"+(i[1]>>>0).toString(16)).slice(-8)+("00000000"+(s[0]>>>0).toString(16)).slice(-8)+("00000000"+(s[1]>>>0).toString(16)).slice(-8)}(ls(e),t>>>0)}function Ks(e){var t,n,r,i=[0];for(t=0;t<e.length;t+=1){for(r=parseInt(e.charAt(t),16),n=i.length-1;n>=0;n-=1)i[n]=16*i[n]+r,r=i[n]/10|0,i[n]%=10;for(;r>0;)i.unshift(r%10),r=r/10|0}return i.join("")}function xs(e,t){var n,r=e.settings,i=e.storage,o=e.splitApi,a=e.readiness,u=e.platform,c=e.telemetryTracker,l=Pr(r)?void 0:Kr(r.core.key),f=r.log;try{n=new _s(r,u)}catch(e){return void f.warn(Ot,[e])}var h=Rs(o.fetchAuth),p=new u.EventEmitter,g=es(f,p,c);n.setEventHandler(g);var d,m,v,y,S=l?void 0:ss(f,t.segmentsSyncTask,i.segments),b=Ts(f,i,t.splitsSyncTask,a.splits,c,l?void 0:t.segmentsSyncTask),E={},T={},R=!1,k=new $i(C,r.scheduler.pushRetryBackoffBase);function C(){if(!d){f.info(lt),d=!1;var e=l?Object.keys(T):void 0;h(e).then((function(t){if(!d)return t.pushEnabled?void(e&&e.length<Object.keys(T).length||function(e){v&&clearTimeout(v),y&&clearTimeout(y);var t=e.decodedToken,r=t.exp-t.iat-Ki,i="number"==typeof e.connDelay&&e.connDelay>=0?e.connDelay:60;f.info(ut,[r,i]),v=setTimeout(C,1e3*r),y=setTimeout((function(){d||n.open(e)}),1e3*i),c.streamingEvent(me,t.exp)}(t)):(f.info(ft),void p.emit(xi))})).catch((function(e){if(!d){if(f.error(sn,[e.message]),e.statusCode>=400&&e.statusCode<500)return c.streamingEvent(Se),void p.emit(xi);p.emit(Pi)}}))}}function w(){d||(d=!0,n.close(),f.info(ht),v&&clearTimeout(v),y&&clearTimeout(y),k.reset(),N())}function N(){b.stop(),l?s(T,(function(e){return e.worker.stop()})):S.stop()}function _(e){switch(e.u){case Ns.BoundedFetchRequest:var t;try{o=e.d,a=e.c,t=ys(o,a)}catch(e){f.warn(Ht,["BoundedFetchRequest",e]);break}return void s(T,(function(n,r){var i,s,o,a,u=n.hash64,c=n.worker;i=t,s=u.hex,o=parseInt(s.slice(8),16)%(8*i.length),a=o%8,(i[Math.floor(o/8)]&1<<a)>0&&c.put(e,void 0,Es(e,r))}));case Ns.KeyList:var n,r,i=void 0;try{i=Ss(e.d,e.c),n=new Set(i.a),r=new Set(i.r)}catch(e){f.warn(Ht,["KeyList",e]);break}if(!e.n||!e.n.length){f.warn(Ht,["KeyList","No segment name was provided"]);break}return void s(T,(function(t){var i=t.hash64,s=t.worker,o=!!n.has(i.dec)||!r.has(i.dec)&&void 0;void 0!==o&&s.put(e,{added:o?[e.n[0]]:[],removed:o?[]:[e.n[0]]})}));case Ns.SegmentRemoval:if(!e.n||!e.n.length){f.warn(Ht,["SegmentRemoval","No segment name was provided"]);break}return void s(T,(function(t){t.worker.put(e,{added:[],removed:e.n})}))}var o,a;s(T,(function(t,n){t.worker.put(e,void 0,Es(e,n))}))}return p.on(Bi,N),p.on(Ui,(function(){k.reset()})),p.on(xi,(function(){m=!0,w(),p.emit(Bi)})),p.on(Pi,(function(){n.close();var e=k.scheduleCall();f.info(ct,[e/1e3]),p.emit(Bi)})),p.on(Mi.STREAMING_RESET,(function(){d||(v&&clearTimeout(v),C())})),p.on(Wi,b.killSplit),p.on(Gi,b.put),p.on(Hi,b.put),l?(p.on(ji,_),p.on(qi,_)):p.on(zi,S.put),Jn(Object.create(p),{stop:function(){w(),l&&this.remove(l)},start:function(){m||!1===d||(d=!1,l?this.add(l,t.segmentsSyncTask):setTimeout(C))},isRunning:function(){return!1===d},add:function(e,t){var n,r,s=ks(e);E[s]||(E[s]=e,T[e]={hash64:(n=e,r=Ms(n).slice(0,16),{hex:r,dec:Ks(r)}),worker:is(f,i,t,c)},R=!0,this.isRunning()&&setTimeout((function(){R&&(R=!1,C())}),0))},remove:function(e){var t=ks(e);delete E[t],delete T[e]}})}function Ps(e,t,n,r,i,s,o){var a=n.segments,u=n.largeSegments,c=!0,l=!0;function f(e){return l&&(e=Xr(i,e)),e}function h(e){var t;void 0!==e.type?t=e.type===qi?u.resetSegments(e):a.resetSegments(e):(t=a.resetSegments(e.ms||{}),t=u.resetSegments(e.ls||{})||t),n.save&&n.save(),Nr(n)&&(t||c)&&(c=!1,r.emit(mi))}function p(n,r,i,a){var u=r?new Promise((function(e){h(r),e(!0)})):t(o,i,a,f).then((function(e){return h(e),l=!1,!0}));return u.catch((function(t){return l&&s>n?(n+=1,e.warn(Nt,[n,t]),p(n)):(l=!1,!1)}))}return function(e,t,n){return p(0,e,t,n)}}!function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zlib=2]="Zlib"}(ws||(ws={})),function(e){e[e.UnboundedFetchRequest=0]="UnboundedFetchRequest",e[e.BoundedFetchRequest=1]="BoundedFetchRequest",e[e.KeyList=2]="KeyList",e[e.SegmentRemoval=3]="SegmentRemoval"}(Ns||(Ns={}));var Us=36e5,Bs=24*Us;function js(e,t,n){var r,i=t.log,s=Pr(t)?Bs:Us;return function o(a,u,c,l,f){r&&Date.now()-r>s&&(t.sync.flagSpecVersion=we);var h=e(a,u,c,t.sync.flagSpecVersion===we?l:void 0).catch((function(n){if((!n.statusCode||400===n.statusCode)&&function(e){return e.urls.sdk!==fr.urls.sdk}(t)&&t.sync.flagSpecVersion===we)return i.error(Pn+"Proxy error detected. Retrying with spec 1.2. If you are using Split Proxy, please upgrade to latest version"),r=Date.now(),t.sync.flagSpecVersion="1.2",e(a,u,c);throw n}));return f&&(h=f(h)),h.then((function(e){return e.json()})).then((function(e){return e.splits?{ff:{d:e.splits,s:e.since,t:e.till}}:r?(i.info(Pn+"Proxy error recovered"),r=void 0,o(-1,void 0,void 0,-1).then((function(e){return Promise.all([n.splits.clear(),n.rbSegments.clear()]).then((function(){return e}))}))):e}))}}function qs(e,t){void 0===t&&(t=Ne);var n=e,r=n.conditions,i=void 0===r?[]:r,s=n.excluded,o=new Set;s&&s.segments&&s.segments.forEach((function(e){var n=e.type,r=e.name;(n===Ae&&t===Ne||n===Ie&&t===_e)&&o.add(r)}));for(var a=0;a<i.length;a++){i[a].matcherGroup.matchers.forEach((function(e){e.matcherType===t&&o.add(e.userDefinedSegmentMatcherData.segmentName)}))}return o}function zs(e,t,n){return e.reduce((function(e,r){return"ACTIVE"!==r.status||n&&!function(e,t){var n=t.groupedFilters,r=n.bySet,i=n.byName,s=n.byPrefix;if(r.length>0)return e.sets&&e.sets.some((function(e){return r.indexOf(e)>-1}));var o=i.length>0,a=s.length>0;if(!o&&!a)return!0;var u=o&&i.indexOf(e.name)>-1,c=a&&s.some((function(t){return g(e.name,t)}));return u||c}(r,n)?e.removed.push(r):(e.added.push(r),qs(r).forEach((function(e){t.add(e)}))),e}),{added:[],removed:[]})}function Ws(e,t,n,r,i,s,o,a){void 0===s&&(s=0),void 0===o&&(o=0);var u=n.splits,c=n.rbSegments,l=n.segments,f=!0;function h(e){return f&&s&&(e=Xr(s,e)),e}return function(s,p,g){return Promise.all([u.getChangeNumber(),c.getChangeNumber()]).then((function d(m,v){void 0===v&&(v=0);var y=m[0],S=m[1];return e.debug(qe,m),Promise.resolve(g?g.type===Gi?Promise.resolve(c.contains(qs(g.payload,_e))).then((function(e){return e?{ff:{d:[g.payload],t:g.changeNumber}}:t(y,s,p,S,h)})):{rbs:{d:[g.payload],t:g.changeNumber}}:t(y,s,p,S,h)).then((function(t){var s=new Set,o=!1;if(t.ff){var h=zs(t.ff.d,s,r),p=h.added,g=h.removed;e.debug(ze,[p.length,g.length]),o=u.update(p,g,t.ff.t)}var d=!1;if(t.rbs){var m=zs(t.rbs.d,s);p=m.added,g=m.removed;e.debug(We,[p.length,g.length]),d=c.update(p,g,t.rbs.t)}return Promise.all([o,d,l.registerSegments(zr(s))]).then((function(e){var t=e[0],r=e[1];return n.save&&n.save(),f=!1,!i||Promise.resolve(!i.splitsArrived||(t||r)&&(a||function(e){return Promise.resolve(e.getRegisteredSegments()).then((function(t){return Promise.all(t.map((function(t){return e.getChangeNumber(t)}))).then((function(e){return e.every((function(e){return void 0!==e}))}))}))}(l))).catch((function(){return!1})).then((function(e){return e&&i.emit(gi),!0}))}))})).catch((function(t){return f&&o>v?(v+=1,e.warn(at,[v,t]),d(m,v)):(f=!1,e.warn(_t,[t]),!1)}))}))}}function Gs(e){var t=e.splitApi,n=e.storage,r=e.readiness,i=e.settings,o=i.log,a=function(e,t,n,r,i){return si(r.log,Ws(r.log,js(e,r,t),t,r.sync.__splitFiltersValidation,n.splits,r.startup.requestTimeoutBeforeReady,r.startup.retriesOnFailureBeforeReady,i),r.scheduler.featuresRefreshRate,"splitChangesUpdater")}(t.fetchSplitChanges,n,r,i,!0),u={},c=h(Kr(i.core.key),r,n);function l(){s(u,(function(e){e.start()}))}function f(){s(u,(function(e){e.isRunning()&&e.stop()}))}function h(e,n,r){var s=function(e,t,n,r,i){return si(r.log,Ps(r.log,function(e){return function(t,n,r,i){var s=e(t,n,r);return i&&(s=i(s)),s.then((function(e){return e.json()}))}}(e),t,n.segments,r.startup.requestTimeoutBeforeReady,r.startup.retriesOnFailureBeforeReady,i),r.scheduler.segmentsRefreshRate,"mySegmentsUpdater")}(t.fetchMemberships,r,n,i,e);function o(){n.isReady()||Nr(r)||n.segments.emit(mi)}return Nr(r)?n.splits.once(gi,o):setTimeout(o,0),u[e]=s,s}return r.splits.on(gi,(function(){if(a.isRunning()){var e=Nr(n);e!==c.isRunning()&&(o.info(it,[e?"ON":"OFF"]),e?l():f())}})),{splitsSyncTask:a,segmentsSyncTask:c,start:function(){o.info(st),a.start(),Nr(n)&&l()},stop:function(){o.info(ot),a.isRunning()&&a.stop(),f()},isRunning:a.isRunning,syncAll:function(){var e=[a.execute()];return s(u,(function(t){e.push(t.execute())})),Promise.all(e)},add:h,remove:function(e){delete u[e]},get:function(e){return u[e]}}}function Hs(e){return null!=e&&"function"==typeof e.then}function Qs(e,t,n){return null==t||l(t)?t:(e.error(ln,[n,"attributes"]),!1)}function Vs(e,t,n){if(!Qs(e,t,n))return!1;var r=!0;return Object.keys(t).forEach((function(i){(function(e,t,n,r){if(!f(t)||0===t.length)return e.warn(r+": you passed an invalid attribute name, attribute name must be a non-empty string."),!1;var i=f(n),s=u(n),o=a(n),c=Array.isArray(n);return!!(i||s||o||c)||(e.warn(r+": you passed an invalid attribute value for "+t+". Acceptable types are: string, number, boolean and array of strings."),!1)})(e,i,t[i],n)||(r=!1)})),r}var Js=/^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/,Ys="event_type";var $s={NULL:0,STRING:2,BOOLEAN:4,NUMBER:8},Zs=300,Xs=32768,eo=1024;function to(e,t,n){if(null==t)return{properties:null,size:eo};if(!l(t))return e.error(ln,[n,"properties"]),{properties:!1,size:eo};var r=Object.keys(t),i=Jn({},t),s={properties:i,size:eo};r.length>Zs&&e.warn(Mt,[n]);for(var o=0;o<r.length;o++){s.size+=r[o].length*$s.STRING;var c=i[r[o]],h=f(c),p=u(c),g=a(c),d=null===c;if(h||p||g||d||(i[r[o]]=null,c=null,d=!0,e.warn(Dt,[n,r[o]])),d?s.size+=$s.NULL:p?s.size+=$s.NUMBER:g?s.size+=$s.BOOLEAN:h&&(s.size+=c.length*$s.STRING),s.size>Xs){e.error(fn,[n]),s.properties=!1;break}}return s}var no=/[A-Z]/,ro="traffic_type";function io(e,t,n){return!t.isDestroyed()||(e.error(pn,[n]),!1)}function so(e,t,n,r){return!!t.isReadyFromCache()||(e.warn(wt,[n,r?" for feature flag "+r.toString():""]),!1)}function oo(e,t,n,r){return io(e,t,n)&&so(e,t,n,r)}var ao="fallback - ",uo=function(){function e(e){void 0===e&&(e={}),this.fallbacks=e}return e.prototype.resolve=function(e,t){var n,r=null===(n=this.fallbacks.byFlag)||void 0===n?void 0:n[e];return r?this.copyWithLabel(r,t):this.fallbacks.global?this.copyWithLabel(this.fallbacks.global,t):{treatment:y,config:null,label:t}},e.prototype.copyWithLabel=function(e,t){return f(e)?{treatment:e,config:null,label:""+ao+t}:{treatment:e.treatment,config:e.config,label:""+ao+t}},e}(),co="killed",lo="default rule",fo="definition not found",ho="not ready",po="exception",go="archived",mo="not in split",vo="targeting rule type unsupported by sdk",yo="prerequisites not met",So=ao+fo;function bo(e,t,n,r,i){return!t.isReady()||r!==fo&&r!==So&&null!=r||(e.warn(Pt,[i,n]),!1)}function Eo(e,t,n){e.warn(Bt,[n,t])}function To(e){var t=e.conditions,n=r(t,(function(e){return"ROLLOUT"===e.conditionType}));return n||(n=t[0]),n?n.partitions.map((function(e){return e.treatment})):[]}function Ro(e){return e?{name:e.name,trafficType:e.trafficTypeName,killed:e.killed,changeNumber:e.changeNumber||0,treatments:To(e),configs:e.configurations||{},sets:e.sets||[],defaultTreatment:e.defaultTreatment,impressionsDisabled:!0===e.impressionsDisabled,prerequisites:(e.prerequisites||[]).map((function(e){return{flagName:e.n,treatments:e.ts}}))}:null}function ko(e){var t=[];return e.forEach((function(e){var n=Ro(e);n&&t.push(n)})),t}function Co(e,t,n){var r=n.readinessManager,i=n.sdkStatus,s=e.log,o=Oe(e.mode);return Jn(Object.create(i),{split:function(e){var n=Qn(s,e,W);if(!oo(s,r,W)||!n)return o?Promise.resolve(null):null;var i=t.getSplit(n);return Hs(i)?i.catch((function(){return null})).then((function(e){return bo(s,r,n,e,W),Ro(e)})):(bo(s,r,n,i,W),Ro(i))},splits:function(){if(!oo(s,r,G))return o?Promise.resolve([]):[];var e=t.getAll();return Hs(e)?e.catch((function(){return[]})).then(ko):ko(e)},names:function(){if(!oo(s,r,H))return o?Promise.resolve([]):[];var e=t.getSplitNames();return Hs(e)?e.catch((function(){return[]})):e}})}var wo=function(){function e(){this.attributesCache={}}return e.prototype.setAttribute=function(e,t){return this.attributesCache[e]=t,!0},e.prototype.getAttribute=function(e){return this.attributesCache[e]},e.prototype.setAttributes=function(e){return this.attributesCache=Jn(this.attributesCache,e),!0},e.prototype.getAll=function(){return this.attributesCache},e.prototype.removeAttribute=function(e){return Object.keys(this.attributesCache).indexOf(e)>=0&&(delete this.attributesCache[e],!0)},e.prototype.clear=function(){return this.attributesCache={},!0},e}();function No(e,t,n){var r=function(e,t){var n=new wo,r=t.getTreatment,i=t.getTreatmentWithConfig,s=t.getTreatments,o=t.getTreatmentsWithConfig,a=t.getTreatmentsByFlagSets,u=t.getTreatmentsWithConfigByFlagSets,c=t.getTreatmentsByFlagSet,l=t.getTreatmentsWithConfigByFlagSet;function f(e){var t=n.getAll();return Object.keys(t).length>0?Jn({},t,e):e}return Jn(t,{getTreatment:function(e,t,n,i){return r(e,t,f(n),i)},getTreatmentWithConfig:function(e,t,n,r){return i(e,t,f(n),r)},getTreatments:function(e,t,n,r){return s(e,t,f(n),r)},getTreatmentsWithConfig:function(e,t,n,r){return o(e,t,f(n),r)},getTreatmentsByFlagSets:function(e,t,n,r){return a(e,t,f(n),r)},getTreatmentsWithConfigByFlagSets:function(e,t,n,r){return u(e,t,f(n),r)},getTreatmentsByFlagSet:function(e,t,n,r){return c(e,t,f(n),r)},getTreatmentsWithConfigByFlagSet:function(e,t,n,r){return l(e,t,f(n),r)},setAttribute:function(t,r){var i={};return i[t]=r,!!Vs(e,i,"setAttribute")&&(e.debug("stored "+r+" for attribute "+t),n.setAttribute(t,r))},getAttribute:function(t){return e.debug("retrieved attribute "+t),n.getAttribute(t+"")},setAttributes:function(t){return!!Vs(e,t,"setAttributes")&&n.setAttributes(t)},getAttributes:function(){return n.getAll()},removeAttribute:function(t){return e.debug("removed attribute "+t),n.removeAttribute(t+"")},clearAttributes:function(){return n.clear()}})}(e,t);return Jn(r,{getTreatment:r.getTreatment.bind(r,n),getTreatmentWithConfig:r.getTreatmentWithConfig.bind(r,n),getTreatments:r.getTreatments.bind(r,n),getTreatmentsWithConfig:r.getTreatmentsWithConfig.bind(r,n),getTreatmentsByFlagSets:r.getTreatmentsByFlagSets.bind(r,n),getTreatmentsWithConfigByFlagSets:r.getTreatmentsWithConfigByFlagSets.bind(r,n),getTreatmentsByFlagSet:r.getTreatmentsByFlagSet.bind(r,n),getTreatmentsWithConfigByFlagSet:r.getTreatmentsWithConfigByFlagSet.bind(r,n),track:r.track.bind(r,n),isClientSide:!0,key:n})}var _o={UNDEFINED:0,ALL_KEYS:1,IN_SEGMENT:2,WHITELIST:3,EQUAL_TO:4,GREATER_THAN_OR_EQUAL_TO:5,LESS_THAN_OR_EQUAL_TO:6,BETWEEN:7,EQUAL_TO_SET:8,CONTAINS_ANY_OF_SET:9,CONTAINS_ALL_OF_SET:10,PART_OF_SET:11,ENDS_WITH:12,STARTS_WITH:13,CONTAINS_STRING:14,IN_SPLIT_TREATMENT:15,EQUAL_TO_BOOLEAN:16,MATCHES_STRING:17,EQUAL_TO_SEMVER:18,GREATER_THAN_OR_EQUAL_TO_SEMVER:19,LESS_THAN_OR_EQUAL_TO_SEMVER:20,BETWEEN_SEMVER:21,IN_LIST_SEMVER:22,IN_LARGE_SEGMENT:23,IN_RULE_BASED_SEGMENT:24},Ao={BOOLEAN:"BOOLEAN",STRING:"STRING",NUMBER:"NUMBER",SET:"SET",DATETIME:"DATETIME",NOT_SPECIFIED:"NOT_SPECIFIED"};function Io(e){return e?e.segmentName||e.largeSegmentName:void 0}function Oo(e){return e&&e.whitelist}function Fo(e){return e.value}function Lo(e){return new Date(e).setUTCHours(0,0,0,0)}function Do(e){return new Date(e).setUTCSeconds(0,0)}function Mo(e){var t=e.map((function(e){var t,n=e.matcherType,r=e.negate,i=e.keySelector,s=e.userDefinedSegmentMatcherData,o=e.userDefinedLargeSegmentMatcherData,a=e.whitelistMatcherData,u=e.unaryNumericMatcherData,c=e.betweenMatcherData,l=e.dependencyMatcherData,f=e.booleanMatcherData,h=e.stringMatcherData,p=e.betweenStringMatcherData,g=i&&i.attribute,d=function(e){var t=_o[e];return t||_o.UNDEFINED}(n),m=Ao.STRING;return d===_o.IN_SEGMENT?t=Io(s):d===_o.IN_LARGE_SEGMENT?t=Io(o):d===_o.EQUAL_TO?(t=Fo(u),m=Ao.NUMBER,"DATETIME"===u.dataType&&(t=Lo(t),m=Ao.DATETIME)):d===_o.GREATER_THAN_OR_EQUAL_TO||d===_o.LESS_THAN_OR_EQUAL_TO?(t=Fo(u),m=Ao.NUMBER,"DATETIME"===u.dataType&&(t=Do(t),m=Ao.DATETIME)):d===_o.BETWEEN?(t=c,m=Ao.NUMBER,"DATETIME"===t.dataType&&(t=function(e){return{dataType:e.dataType,start:Do(e.start),end:Do(e.end)}}(t),m=Ao.DATETIME)):d===_o.BETWEEN_SEMVER?t=p:d===_o.EQUAL_TO_SET||d===_o.CONTAINS_ANY_OF_SET||d===_o.CONTAINS_ALL_OF_SET||d===_o.PART_OF_SET?(t=Oo(a),m=Ao.SET):d===_o.WHITELIST||d===_o.IN_LIST_SEMVER||d===_o.STARTS_WITH||d===_o.ENDS_WITH||d===_o.CONTAINS_STRING?t=Oo(a):d===_o.IN_SPLIT_TREATMENT?(t=l,m=Ao.NOT_SPECIFIED):d===_o.EQUAL_TO_BOOLEAN?(m=Ao.BOOLEAN,t=f):d===_o.MATCHES_STRING||d===_o.EQUAL_TO_SEMVER||d===_o.GREATER_THAN_OR_EQUAL_TO_SEMVER||d===_o.LESS_THAN_OR_EQUAL_TO_SEMVER?t=h:d===_o.IN_RULE_BASED_SEGMENT&&(t=Io(s),m=Ao.NOT_SPECIFIED),{attribute:g,negate:r,type:d,name:n,value:t,dataType:m}}));return-1===i(t,(function(e){return e.type===_o.UNDEFINED}))?t:[]}var Ko=function(){function e(e,t){if(100!==e[e.length-1])throw new RangeError("Provided invalid dataset as input");this._ranges=e,this._treatments=t}return e.parse=function(t){var n=t.reduce((function(e,t){var n=t.size,r=t.treatment;return e.ranges.push(e.inc+=n),e.treatments.push(r),e}),{inc:0,ranges:[],treatments:[]});return new e(n.ranges,n.treatments)},e.prototype.getTreatmentFor=function(e){if(e<0||e>100)throw new RangeError("Please provide a value between 0 and 100");var t=i(this._ranges,(function(t){return e<=t}));return this._treatments[t]},e}();var xo=/^[0-9]+$/,Po=".";function Uo(e,t){if(xo.test(e)&&xo.test(t)){var n=e.length-t.length;if(0!==n)return n}return e<t?-1:e>t?1:0}function Bo(e){return e.replace(/^0+(?=\d)/,"")}function jo(e){throw new Error("Unable to convert to Semver, incorrect format: "+e)}var qo=function(){function e(e){f(e)||jo(e);var t=e.indexOf("+"),n=-1===t?[e]:[e.slice(0,t),e.slice(t+1)],r=n[0],i=n[1];""===i&&jo(e),-1===(t=r.indexOf("-"))?(this._isStable=!0,this._preRelease=[]):(this._isStable=!1,this._preRelease=r.slice(t+1).split(Po).map((function(t){return t||jo(e),xo.test(t)?Bo(t):t})),r=r.slice(0,t));var s=r.split(Po).map((function(t){return t&&xo.test(t)||jo(e),Bo(t)}));3!==s.length&&jo(e),this._major=s[0],this._minor=s[1],this._patch=s[2],this.version=s.join(Po),this._preRelease.length&&(this.version+="-"+this._preRelease.join(Po)),i&&(this.version+="+"+i)}return e.prototype.compare=function(e){if(this.version===e.version)return 0;var t=Uo(this._major,e._major);if(0!==t)return t;if(0!==(t=Uo(this._minor,e._minor)))return t;if(0!==(t=Uo(this._patch,e._patch)))return t;if(!this._isStable&&e._isStable)return-1;if(this._isStable&&!e._isStable)return 1;for(var n=0,r=Math.min(this._preRelease.length,e._preRelease.length);n<r;n++){var i=Uo(this._preRelease[n],e._preRelease[n]);if(0!==i)return i}return this._preRelease.length-e._preRelease.length},e}();var zo=[void 0,function(){return function(e){return null!=e}},function(e,t){return function(n){return t.segments.isInSegment(e,n)}},function(e){var t=new Set(e);return function(e){return t.has(e)}},function(e){return function(t){return t===e}},function(e){return function(t){return t>=e}},function(e){return function(t){return t<=e}},function(e){return function(t){return t>=e.start&&t<=e.end}},function(e){return function(t){for(var n=t.length===e.length,r=function(r){i(e,(function(e){return e===t[r]}))<0&&(n=!1)},s=0;s<t.length&&n;s++)r(s);return n}},function(e){return function(t){for(var n=!1,r=function(r){i(t,(function(t){return t===e[r]}))>=0&&(n=!0)},s=0;s<e.length&&!n;s++)r(s);return n}},function(e){return function(t){var n=!0;if(t.length<e.length)n=!1;else for(var r=function(r){i(t,(function(t){return t===e[r]}))<0&&(n=!1)},s=0;s<e.length&&n;s++)r(s);return n}},function(e){return function(t){for(var n=t.length<=e.length,r=function(r){i(e,(function(e){return e===t[r]}))<0&&(n=!1)},s=0;s<t.length&&n;s++)r(s);return n}},function(e){return function(t){return e.some((function(e){return r=e,void 0===i&&(i=!1),!(!f(n=t)||!f(r))&&(i&&(n=n.toLowerCase(),r=r.toLowerCase()),n.slice(n.length-r.length)===r);var n,r,i}))}},function(e){return function(t){return e.some((function(e){return g(t,e)}))}},function(e){return function(t){return e.some((function(e){return f(t)&&t.indexOf(e)>-1}))}},function(e,t,n){var r=e.split,i=e.treatments;function s(e,t,r){var i=!1;return Array.isArray(t)&&(i=-1!==t.indexOf(e.treatment)),n.debug(10,[r,e.treatment,e.label,r,t,i]),i}return function(e,o){var a=e.key,u=e.attributes;n.debug(11,[r,JSON.stringify(a),u?"\n attributes: "+JSON.stringify(u):""]);var c=o(n,a,r,u,t);return Hs(c)?c.then((function(e){return s(e,i,r)})):s(c,i,r)}},function(e){return function(t){return e===t}},function(e){var t=new RegExp(e);return function(e){return t.test(e)}},function(e){var t=new qo(e);return function(e){var n=new qo(e);return t.version===n.version}},function(e){var t=new qo(e);return function(e){return new qo(e).compare(t)>=0}},function(e){var t=new qo(e);return function(e){return new qo(e).compare(t)<=0}},function(e){var t=new qo(e.start),n=new qo(e.end);return function(e){var r=new qo(e);return t.compare(r)<=0&&n.compare(r)>=0}},function(e){if(!e||0===e.length)throw new Error("whitelistMatcherData is required for IN_LIST_SEMVER matcher type");var t=new Set(e.map((function(e){return new qo(e).version})));return function(e){var n=new qo(e).version;return t.has(n)}},function(e,t){return function(n){return!!t.largeSegments&&t.largeSegments.isInSegment(e,n)}},function e(t,n,r){return function(i,s){var o=i.key,a=i.attributes,u=Kr(o);function c(e){var t=e.conditions||[];if(!t.length)return!1;var i=Zo(r,t,n)(xr(o),void 0,void 0,void 0,a,s);return Hs(i)?i.then((function(e){return!!e})):!!i}function l(t){var i=t.type,c=t.name;return i===Ae?n.segments.isInSegment(c,u):i===Ie?e(c,n,r)({key:o,attributes:a},s):!("large"!==i||!n.largeSegments)&&n.largeSegments.isInSegment(c,u)}function f(e){if(!e)return!1;var t=function(e){var t=e.excluded||{};return!(!t.keys||-1===t.keys.indexOf(u))||(t.segments||[]).reduce((function(e,t){return Hs(e)?e.then((function(e){return e||l(t)})):e||l(t)}),!1)}(e);return Hs(t)?t.then((function(t){return!t&&c(e)})):!t&&c(e)}var h=n.rbSegments.get(t);return Hs(h)?h.then(f):f(h)}}];function Wo(e,t,n){var r,i=t.type,s=t.value;return zo[i]&&(r=zo[i](s,n,e)),r}function Go(e,t){return{key:e,attributes:t}}function Ho(e,t,n,r,i){var s,o,a=function(e,t){switch(e){case _o.EQUAL_TO:return"DATETIME"===t?Lo:void 0;case _o.GREATER_THAN_OR_EQUAL_TO:case _o.LESS_THAN_OR_EQUAL_TO:case _o.BETWEEN:return"DATETIME"===t?Do:void 0;case _o.IN_SPLIT_TREATMENT:case _o.IN_RULE_BASED_SEGMENT:return Go;default:return}}(t,r);switch(r){case Ao.NUMBER:case Ao.DATETIME:o=d(n),s=isNaN(o)?void 0:o;break;case Ao.STRING:s=function(e){var t=e;return l(e)&&(t=e.matchingKey?e.matchingKey:void 0),m(t)||void 0}(n);break;case Ao.SET:s=function(e){var t=Array.isArray(e)?v(e.map((function(e){return e+""}))):[];return t.length?t:void 0}(n);break;case Ao.BOOLEAN:s=function(e){if(!0===e||!1===e)return e;if("string"==typeof e){var t=e.toLocaleLowerCase();if("true"===t)return!0;if("false"===t)return!1}}(n);break;case Ao.NOT_SPECIFIED:s=n;break;default:s=void 0}return a&&(s=a(s,i)),e.debug(xe,[n,r,s instanceof Object?JSON.stringify(s):s]),s}function Qo(e,t,n,r){var i=n.attribute,s=function(e,t,n,r){var i=void 0;return n?r?(i=r[n],e.debug(Ke,[n,i])):e.warn(kt,[n]):i=t,i}(e,t,i,r),o=Ho(e,n.type,s,n.dataType,r);return void 0!==o?o:void e.warn(Rt,[s+(i?" for attribute "+i:"")])}function Vo(e,t,n,r){var i=ds(t,n),s=r.getTreatmentFor(i);return e.debug(Me,[i,t,n,s]),s}function Jo(e,t,n,r,i,s){if(t)return!i||{treatment:Vo(e,n,r,i),label:s}}function Yo(e,t,n,r,i){return function(s,o,a,u,c,l){if("ROLLOUT"===i&&!function(e,t,n){return!(e<100&&ds(t,n)>e)}(a,s.bucketingKey,u))return{treatment:void 0,label:mo};var f=t(s,c,l);return Hs(f)?f.then((function(t){return Jo(e,t,s.bucketingKey,o,n,r)})):Jo(e,f,s.bucketingKey,o,n,r)}}function $o(e,t){function n(t){var n=t.every((function(e){return e}));return e.debug(Fe,[n]),n}return function(e,r,s){var o=t.map((function(t){return t(e,r,s)}));return-1!==i(o,Hs)?Promise.all(o).then(n):n(o)}}function Zo(e,t,n){for(var r=[],s=0;s<t.length;s++){var o=t[s],u=o.matcherGroup,c=o.partitions,l=o.label,f=o.conditionType,h=Mo(u.matchers).map((function(t){var r;try{r=Wo(e,t,n)}catch(n){e.error(wn,[t.name,n])}return function(n,i,s){var o=Qo(e,n,t,i),a=!1;if(void 0!==o&&r)try{a=r(o,s)}catch(n){e.error(wn,[t.name,n])}function u(n){return e.debug(Ye,[t.name,n,t.value,o]),Boolean(n^t.negate)}return Hs(a)?a.then(u):u(a)}}));if(0===h.length){r=[];break}r.push(Yo(e,$o(e,h),c&&Ko.parse(c),l,f))}return function(e,t){function n(t){for(var n=0,r=t.length;n<r;n++){var i=t[n];if(void 0!==i)return a(i)||e.debug(Le,[i.treatment]),i}e.debug(De)}return Array.isArray(t)&&0!==t.length?function(e,r,s,o,a,u){var c=t.map((function(t){return t(e,r,s,o,a,u)}));return-1!==i(c,Hs)?Promise.all(c).then((function(e){return n(e)})):n(c)}:function(){return e.error(Zt),{treatment:y,label:vo}}}(e,r)}function Xo(e,t){return{treatment:o(e,"treatment",t),label:o(e,"label",lo)}}function ea(e,t,n){var r=t.killed,i=t.seed,s=t.trafficAllocation,o=t.trafficAllocationSeed,a=t.status,u=t.conditions,c=t.prerequisites,l=f(t.defaultTreatment)?t.defaultTreatment:y,h=Zo(e,u,n),p=function(e,t,n){return function(r,i){var s=r.key,o=r.attributes;function a(e){var r=i(n,s,e.n,o,t);return Hs(r)?r.then((function(t){return-1!==e.ts.indexOf(t.treatment)})):-1!==e.ts.indexOf(r.treatment)}return(e=null==e?[]:e).reduce((function(e,t){return Hs(e)?e.then((function(e){return!!e&&a(t)})):!!e&&a(t)}),!0)}}(c,n,e);return{getTreatment:function(t,n,u){var c=xr(t);function f(t){if(!t)return e.debug($e,["Prerequisite not met"]),{treatment:l,label:yo};var r=h(c,i,s,o,n,u);return Hs(r)?r.then((function(e){return Xo(e,l)})):Xo(r,l)}if("ARCHIVED"===a)return{treatment:y,label:go};if(r)return e.debug($e,["Flag is killed"]),{treatment:l,label:co};var g=p({key:t,attributes:n},u);return Hs(g)?g.then(f):f(g)}}}var ta={treatment:y,label:po,config:null};function na(e){var t={};return e.forEach((function(e){t[e]=ta})),t}function ra(e,t,n,r,i,s){var o;try{o=i.splits.getSplit(n)}catch(e){return ta}return Hs(o)?o.then((function(n){return sa(e,t,n,r,i,s)})).catch((function(){return ta})):sa(e,t,o,r,i,s)}function ia(e,t,n,r,i,s){var o;try{o=i.splits.getSplits(n)}catch(e){return na(n)}return Hs(o)?o.then((function(o){return oa(e,t,n,o,r,i,s)})).catch((function(){return na(n)})):oa(e,t,n,o,r,i,s)}function sa(e,t,n,r,i,s){var o={treatment:y,label:fo,config:null};if(n){if(Hs(o=ea(e,n,i).getTreatment(t,r,ra)))return o.then((function(e){return e.changeNumber=n.changeNumber,e.config=n.configurations&&n.configurations[e.treatment]||null,e.impressionsDisabled=(null==s?void 0:s.impressionsDisabled)||n.impressionsDisabled,e}));o.changeNumber=n.changeNumber,o.config=n.configurations&&n.configurations[o.treatment]||null,o.impressionsDisabled=(null==s?void 0:s.impressionsDisabled)||n.impressionsDisabled}return o}function oa(e,t,n,r,i,s,o){var a={},u=[];return n.forEach((function(n){var c=sa(e,t,r[n],i,s,o);Hs(c)?u.push(c.then((function(e){a[n]=e}))):a[n]=c})),u.length>0?Promise.all(u).then((function(){return a})):a}var aa={treatment:y,label:ho};function ua(e){var t={};return e.forEach((function(e){t[e]=aa})),t}function ca(e){if(e&&e.properties)try{return JSON.stringify(e.properties)}catch(e){}}function la(e){var t=e.sdkReadinessManager.readinessManager,n=e.storage,r=e.settings,i=e.impressionsTracker,s=e.eventTracker,o=e.telemetryTracker,a=e.fallbackTreatmentsCalculator,u=r.log,c=r.mode,f=Oe(c);function h(e,r,s,a,c,l){void 0===c&&(c=!1),void 0===l&&(l=M);var h=o.trackEval(c?oe:ie),p=function(t){var n=[],o=d(t,r,e,ca(a),c,l,n);return i.track(n,s),h(n[0]&&n[0].imp.label),o},g=t.isReadyFromCache()?ra(u,e,r,s,n,a):f?Promise.resolve(aa):aa;return Hs(g)?g.then((function(e){return p(e)})):p(g)}function p(e,r,s,a,c,l){void 0===c&&(c=!1),void 0===l&&(l=K);var h=o.trackEval(c?ae:se),p=function(t){var n=[],r={},o=ca(a);return Object.keys(t).forEach((function(i){r[i]=d(t[i],i,e,o,c,l,n)})),i.track(n,s),h(n[0]&&n[0].imp.label),r},g=t.isReadyFromCache()?ia(u,e,r,s,n,a):f?Promise.resolve(ua(r)):ua(r);return Hs(g)?g.then((function(e){return p(e)})):p(g)}function g(e,r,s,a,c,l,h){void 0===c&&(c=!1),void 0===l&&(l=ce),void 0===h&&(h=B);var p=o.trackEval(l),g=function(t){var n=[],r={},o=ca(a);return Object.keys(t).forEach((function(i){r[i]=d(t[i],i,e,o,c,h,n)})),i.track(n,s),p(n[0]&&n[0].imp.label),r},m=t.isReadyFromCache()?function(e,t,n,r,i,s,o){var a;function u(a){for(var u,c=new Set,l=0;l<n.length;l++){var f=a[l];f.size?(u=f,c=new Set(zr(c).concat(zr(u)))):e.warn($t,[s,n[l]])}return c.size?ia(e,t,zr(c),r,i,o):{}}try{a=i.splits.getNamesByFlagSets(n)}catch(e){return{}}return Hs(a)?a.then((function(e){return u(e)})).catch((function(){return{}})):u(a)}(u,e,r,s,n,h,a):f?Promise.resolve({}):{};return Hs(m)?m.then((function(e){return g(e)})):g(m)}function d(e,n,r,i,s,o,c){var f=Kr(r),h=function(e){return l(e)?e.bucketingKey:void 0}(r),p=e.changeNumber,g=e.impressionsDisabled,d=e.treatment,m=e.label,v=e.config,S=void 0===v?null:v;if(d===y){var b=a.resolve(n,m);d=b.treatment,m=b.label,S=b.config}return u.info(et,[n,f,d,m]),bo(u,t,n,m,o)&&(u.info(tt),c.push({imp:{feature:n,keyName:f,treatment:d,time:Date.now(),bucketingKey:h,label:m,changeNumber:p,properties:i},disabled:g})),s?{treatment:d,config:S}:d}return{getTreatment:h,getTreatmentWithConfig:function(e,t,n,r){return h(e,t,n,r,!0,x)},getTreatments:p,getTreatmentsWithConfig:function(e,t,n,r){return p(e,t,n,r,!0,P)},getTreatmentsByFlagSets:g,getTreatmentsWithConfigByFlagSets:function(e,t,n,r){return g(e,t,n,r,!0,fe,q)},getTreatmentsByFlagSet:function(e,t,n,r){return g(e,[t],n,r,!1,ue,U)},getTreatmentsWithConfigByFlagSet:function(e,t,n,r){return g(e,[t],n,r,!0,le,j)},track:function(e,r,i,a,l,f){void 0===f&&(f=1024);var h=o.trackEval(he),p=Kr(e),g={eventTypeId:i,trafficTypeName:r,value:a,timestamp:Date.now(),key:p,properties:l};!function(e,t,n,r,i,s){if(!t.isReady()||r===k)return!0;var o=n.trafficTypeExists(i);Hs(o)?o.then((function(t){return t||Eo(e,i,s),t})):o||Eo(e,i,s)}(u,t,n.splits,c,r,z);var d=s.track(g,f);return Hs(d)?d.then((function(e){return h(),e})):(h(),d)}}}function fa(e,t,r,i){var s=e.log,o=Oe(e.mode);function a(t,i,o,a,u){var c=sr(s,i,t),f=t.indexOf("ByFlagSet")>-1?function(e,t,n,r){var i=Vn(e,n,t,"flag sets","flag set"),s=i?Xn(e,i,t):[];return r.length>0&&(s=s.filter((function(n){return r.indexOf(n)>-1||(e.warn(Yt,[t,n]),!1)}))),!!s.length&&s}(s,t,o,e.sync.__splitFiltersValidation.groupedFilters.bySet):g(t,K)?Vn(s,o,t):Qn(s,o,t),h=Qs(s,a,t),p=io(s,r,t),d=function(e,t,r){if(l(t)){var i=to(e,t.properties,r).properties,s=i&&Object.keys(i).length>0?{properties:i}:void 0,o=t.impressionsDisabled;return o?s?n(n({},s),{impressionsDisabled:o}):{impressionsDisabled:o}:s}t&&e.error(ln,[r,"evaluation options"])}(s,u,t);return so(s,r,t,f),{valid:p&&c&&f&&!1!==h,key:c,nameOrNames:f,attributes:h,options:d}}function c(e,t){var n=i.resolve(e,""),r=n.treatment,s=n.config;return t?{treatment:r,config:s}:r}function h(e){return o?Promise.resolve(e):e}return{getTreatment:function(e,n,r,i){var s=a(M,e,n,r,i);return s.valid?t.getTreatment(s.key,s.nameOrNames,s.attributes,s.options):h(c(s.nameOrNames,!1))},getTreatmentWithConfig:function(e,n,r,i){var s=a(x,e,n,r,i);return s.valid?t.getTreatmentWithConfig(s.key,s.nameOrNames,s.attributes,s.options):h(c(s.nameOrNames,!0))},getTreatments:function(e,n,r,i){var s=a(K,e,n,r,i);if(s.valid)return t.getTreatments(s.key,s.nameOrNames,s.attributes,s.options);var o={};return s.nameOrNames&&s.nameOrNames.forEach((function(e){return o[e]=c(e,!1)})),h(o)},getTreatmentsWithConfig:function(e,n,r,i){var s=a(P,e,n,r,i);if(s.valid)return t.getTreatmentsWithConfig(s.key,s.nameOrNames,s.attributes,s.options);var o={};return s.nameOrNames&&s.nameOrNames.forEach((function(e){return o[e]=c(e,!0)})),h(o)},getTreatmentsByFlagSets:function(e,n,r,i){var s=a(B,e,n,r,i);return s.valid?t.getTreatmentsByFlagSets(s.key,s.nameOrNames,s.attributes,s.options):h({})},getTreatmentsWithConfigByFlagSets:function(e,n,r,i){var s=a(q,e,n,r,i);return s.valid?t.getTreatmentsWithConfigByFlagSets(s.key,s.nameOrNames,s.attributes,s.options):h({})},getTreatmentsByFlagSet:function(e,n,r,i){var s=a(U,e,[n],r,i);return s.valid?t.getTreatmentsByFlagSet(s.key,s.nameOrNames[0],s.attributes,s.options):h({})},getTreatmentsWithConfigByFlagSet:function(e,n,r,i){var s=a(j,e,[n],r,i);return s.valid?t.getTreatmentsWithConfigByFlagSet(s.key,s.nameOrNames[0],s.attributes,s.options):h({})},track:function(e,n,i,a,c){var l=sr(s,e,z),h=function(e,t,n){if(null==t)e.error(gn,[n,ro]);else if(f(t)){if(0!==t.length)return no.test(t)&&(e.warn(Ut,[n]),t=t.toLowerCase()),t;e.error(yn,[n,ro])}else e.error(vn,[n,ro]);return!1}(s,n,z),p=function(e,t,n){if(null==t)e.error(gn,[n,Ys]);else if(f(t))if(0===t.length)e.error(yn,[n,Ys]);else{if(Js.test(t))return t;e.error(cn,[n,t])}else e.error(vn,[n,Ys]);return!1}(s,i,z),g=function(e,t,n){return u(t)||null==t?t:(e.error(hn,[n]),!1)}(s,a,z),d=to(s,c,z),m=d.properties,v=d.size;return io(s,r,z)&&l&&h&&p&&!1!==g&&!1!==m?t.track(l,h,p,g,m,v):!!o&&Promise.resolve(!1)}}}var ha=1e3;function pa(e,t){var n=e.sdkReadinessManager,r=e.syncManager,i=e.storage,s=e.signalListener,o=e.settings,a=e.telemetryTracker,u=e.uniqueKeysTracker,c=0;function l(){return r?r.flush():Promise.resolve()}return Jn(Object.create(n.sdkStatus),fa(o,la(e),n.readinessManager,e.fallbackTreatmentsCalculator),{flush:function(){return function(e,t){var n=Date.now(),r=n-c;return r<t?(o.log.warn("Flush cooldown, remaining time "+(t-r)/1e3+" seconds"),Promise.resolve()):(c=n,e())}(l,ha)},destroy:function(){var e;return n.readinessManager.destroy(),t||(e=o.core.authorizationKey,Ci[e]&&Ci[e]--,0===Ci[e]&&delete Ci[e],a.sessionLength(),s&&s.stop(),u.stop()),r&&r.stop(),l().then((function(){return i.destroy()}))}})}function ga(e,t){return(e.matchingKey?e.matchingKey:e)+"-"+(e.bucketingKey?e.bucketingKey:e)+"-"+(t||"")}function da(e){var t=e.clients,n=e.storage,r=e.syncManager,i=e.sdkReadinessManager,s=e.settings,o=s.core.key,a=s.log,u=s.initialRolloutPlan,c=No(a,pa(e),o),l=ga(xr(o));return t[l]=c,function(s){if(void 0===s)return a.debug(Pe),c;var o=sr(a,s,An);if(!1===o)throw new Error("Shared Client needs a valid key.");var l=ga(o);if(t[l])a.debug(Ue);else{var f=Kr(o),h=i.shared(),p=n.shared&&n.shared(f,(function(e){e?h.readinessManager.timeout():h.readinessManager.segments.emit(mi)}));p&&u&&or(a,u,{segments:p.segments,largeSegments:p.largeSegments},f);var g=r&&p&&r.shared(f,h.readinessManager,p);t[l]=No(a,pa(Jn({},e,{sdkReadinessManager:h,storage:p||n,syncManager:g}),!0),o),a.info(nt)}return t[l]}}var ma="visibilitychange",va="pagehide",ya="for visibilitychange and pagehide events.",Sa=function(){function e(e,t,n,r){this.syncManager=e,this.settings=t,this.storage=n,this.serviceApi=r,this.flushData=this.flushData.bind(this),this.flushDataIfHidden=this.flushDataIfHidden.bind(this),this.fromImpressionsCollector=ci.bind(void 0,t.core.labelsEnabled)}return e.prototype.start=function(){this.settings.log.debug(25,[ya]),"undefined"!=typeof document&&document.addEventListener&&document.addEventListener(ma,this.flushDataIfHidden),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener(va,this.flushData)},e.prototype.stop=function(){this.settings.log.debug(26,[ya]),"undefined"!=typeof document&&document.removeEventListener&&document.removeEventListener(ma,this.flushDataIfHidden),"undefined"!=typeof window&&window.removeEventListener&&window.removeEventListener(va,this.flushData)},e.prototype.flushData=function(){if(this.syncManager){var e=this.settings.urls,t=e.events,n=e.telemetry;if(Ji(this.settings)){var r={sim:this.settings.sync.impressionsMode};this._flushData(t+"/testImpressions/beacon",this.storage.impressions,this.serviceApi.postTestImpressionsBulk,this.fromImpressionsCollector,r),this._flushData(t+"/events/beacon",this.storage.events,this.serviceApi.postEventsBulk),this._flushData(t+"/testImpressions/count/beacon",this.storage.impressionCounts,this.serviceApi.postTestImpressionsCount,fi),this._flushData(n+"/v1/keys/cs/beacon",this.storage.uniqueKeys,this.serviceApi.postUniqueKeysBulkCs)}this.storage.telemetry&&this._flushData(n+"/v1/metrics/usage/beacon",this.storage.telemetry,this.serviceApi.postMetricsUsage)}},e.prototype.flushDataIfHidden=function(){"hidden"===document.visibilityState&&this.flushData()},e.prototype._flushData=function(e,t,n,r,i){if(!t.isEmpty()){var s=r?r(t.pop()):t.pop();this._sendBeacon(e,s,i)||n(JSON.stringify(s)).catch((function(){})),this.settings.log.debug(125,[t.name])}},e.prototype._sendBeacon=function(e,t,n){if("undefined"!=typeof navigator&&navigator.sendBeacon){var r={entries:t,token:this.settings.core.authorizationKey,sdk:this.settings.version};n&&Jn(r,n);var i=JSON.stringify(r);try{return navigator.sendBeacon(e,i)}catch(e){return!1}}return!1},e}(),ba=function(e,t,n,r){this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null},Ea=function(){function e(){this.tail=null,this.head=null,this.length=0}return e.prototype.removeNode=function(e){if(e&&e instanceof ba){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t}},e.prototype.unshiftNode=function(e){if(e&&e instanceof ba&&e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},e.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)this.head=new ba(arguments[e],null,this.head,this),this.tail||(this.tail=this.head),this.length++;return this.length},e}(),Ta=function(){function e(e){this.maxLen=e||1,this.items=new Map,this.lru=new Ea}return e.prototype.get=function(e){var t=this.items.get(e);if(t&&t instanceof ba)return this.lru.unshiftNode(t),t.value.value},e.prototype.set=function(e,t){var n=this.items.get(e);if(n){if(!(n instanceof ba))return!1;this.lru.unshiftNode(n),this.lru.head.value.value=t}else{if(this.lru.length===this.maxLen){var r=this.lru.tail;if(!r)return!1;this.items.delete(r.value.key),this.lru.removeNode(this.lru.tail)}this.lru.unshift({key:e,value:t}),this.items.set(e,this.lru.head)}return!0},e}(),Ra=function(){function e(e,t){this.cache=new Ta(e),this.hasher=t}return e.prototype.testAndSet=function(e){var t=this.hasher(e),n=this.cache.get(t);return this.cache.set(t,e.time),n},e}();function ka(e){return gs(function(e){return e.keyName+":"+e.feature+":"+e.treatment+":"+e.label+":"+e.changeNumber}(e))}var Ca=500;function wa(){return new Ra(Ca,ka)}function Na(e,t){var n=[];if(e.forEach((function(e){var r=e(t);r&&r.queue&&n.push(r)})),0!==n.length)return{handleImpression:function(e){n.forEach((function(t){return t.queue({type:S,payload:e})}))},handleEvent:function(e){n.forEach((function(t){return t.queue({type:b,payload:e})}))}}}var _a={GRANTED:F,DECLINED:L,UNKNOWN:D};function Aa(e){var t=e.settings,n=e.settings.log,r=e.syncManager,i=e.storage,s=i.events,o=i.impressions,u=i.impressionCounts,c=i.uniqueKeys;return Ji(t)||n.info(Tt,[t.userConsent]),{setStatus:function(e){var i,l;if(!a(e))return n.warn(Tn,["UserConsent.setStatus"]),!1;var f=e?F:L;return t.userConsent!==f?(n.info(bt,[t.userConsent,f]),t.userConsent=f,e?null===(i=null==r?void 0:r.submitterManager)||void 0===i||i.start():(null===(l=null==r?void 0:r.submitterManager)||void 0===l||l.stop(!0),s.clear&&s.clear(),o.clear&&o.clear(),u.clear&&u.clear(),c.clear&&c.clear())):n.info(Et,[f]),!0},getStatus:function(){return t.userConsent},Status:_a}}function Ia(e){var t=e.treatment;return e.keys?{conditionType:"WHITELIST",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"WHITELIST",negate:!1,whitelistMatcherData:{whitelist:f(e.keys)?[e.keys]:e.keys}}]},partitions:[{treatment:t,size:100}],label:"whitelisted "+t}:{conditionType:"ROLLOUT",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"ALL_KEYS",negate:!1}]},partitions:[{treatment:t,size:100}],label:"default rule"}}function Oa(e,t,n,r){return si(r.log,function(e,t,n,r){var i=r.log,o=t.splits,a=!0;return function(){var u=[],c=null,l={};try{l=e(r)}catch(e){c=e,i.error(nn,[e])}return!c&&l?(i.debug(je,[JSON.stringify(l)]),s(l,(function(e,t){u.push({name:t,status:"ACTIVE",killed:!1,trafficAllocation:100,defaultTreatment:y,conditions:e.conditions||[],configurations:e.configurations,trafficTypeName:e.trafficTypeName})})),Promise.all([o.clear(),o.update(u,[],Date.now())]).then((function(){return n.splits.emit(gi),a&&(a=!1,Promise.resolve(!!t.validateCache&&t.validateCache()).then((function(e){e&&n.splits.emit(di),n.segments.emit(mi)}))),!0}))):Promise.resolve(!0)}}(e,t,n,r),r.scheduler.offlineRefreshRate,"offlineUpdater")}function Fa(){return Promise.resolve()}var La,Da,Ma,Ka=(La=function(){var e={emptyMock:"1"};return function(t){var n,r,i=t.features||{};if(n=i,!((r=Object.keys(n)).length!==Object.keys(e).length?(e=p({},n),1):r.some((function(t){var r,i,s=!e[t],o=typeof(r=e[t])!=typeof(i=n[t])||("string"==typeof r?r!==i:r.treatment!==i.treatment||r.config!==i.config),a=s||o;return a&&(e=p({},n)),a}))))return!1;var o={};return s(i,(function(e,t){var n=e,r=null;l(e)&&(n=e.treatment,r=e.config||r);var i={};null!==r&&(i[n]=r),o[t]={trafficTypeName:"localhost",conditions:[Ia({treatment:n})],configurations:i}})),o}},function(e){var t=e.settings,n=e.readiness,r=e.storage,i=Oa(La(),r,n,t),s=i.start,o=[];return Jn(i,{start:function(){s(),o.forEach((function(e){return e()})),o.length=0},flush:Fa,shared:function(e,t){function n(){t.segments.emit(mi)}return i.isRunning()?setTimeout(n):o.push(n),{stop:function(){},flush:Fa}}})});function xa(e,t){var n=!1,r=!1;var i=function e(i){var s=new Promise((function(e,n){return i.then(e,(function(e){r?n(e):t(e)}))})),o=s.then;return Object.defineProperty(s,"then",{value:function(t,i){var a=o.call(s,t,i);return"function"==typeof t&&(n=!0),"function"==typeof i?(r=!0,a):e(a)}}),s}(e);return i.hasOnFulfilled=function(){return n},i}function Pa(e,t,n,r){void 0===n&&(n=function(e){var t=Jn(new e,{splitsArrived:!1,splitsCacheLoaded:!1,hasInit:!1,initCallbacks:[]});return t.on(gi,(function(e){e||(t.splitsArrived=!0)})),t.once(di,(function(){t.splitsCacheLoaded=!0})),t}(e));var i=t.startup.readyTimeout,s=function(e){var t=Jn(new e,{segmentsArrived:!1});return t.once(mi,(function(){t.segmentsArrived=!0})),t}(e),o=new e,a=0;function u(){var e=Date.now();a=e>a?e:a+1}var c=!1;n.splitsCacheLoaded?c=!0:n.once(di,(function(){if(c=!0,!h&&!g)try{u(),o.emit(Si,h)}catch(e){setTimeout((function(){throw e}),0)}}));var l=!1;function f(){l||h||(l=!0,u(),o.emit(vi,"Split SDK emitted SDK_READY_TIMED_OUT event."))}var h=!1;n.on(gi,m),s.on(mi,m);var p,g=!1;function d(){g=!1,i>0&&!h&&(p=setTimeout(f,i))}function m(e){if(!g)if(h)try{u(),o.emit(bi,e)}catch(e){setTimeout((function(){throw e}),0)}else if(n.splitsArrived&&s.segmentsArrived){clearTimeout(p),h=!0;try{u(),c||(c=!0,o.emit(Si,h)),o.emit(yi)}catch(e){setTimeout((function(){throw e}),0)}}}return n.initCallbacks.push(d),n.hasInit&&d(),{splits:n,segments:s,gate:o,shared:function(){return Pa(e,t,n,!0)},timeout:f,setDestroyed:function(){g=!0},init:function(){n.hasInit||(n.hasInit=!0,n.initCallbacks.forEach((function(e){return e()})))},destroy:function(){g=!0,u(),clearTimeout(p),r||(n.hasInit=!1)},isReady:function(){return h},isReadyFromCache:function(){return c},isTimedout:function(){return l&&!h},hasTimedout:function(){return l},isDestroyed:function(){return g},isOperational:function(){return(h||c)&&!g},lastUpdate:function(){return a}}}var Ua="newListener",Ba="removeListener",ja=new Error(vi);function qa(e,t,n){void 0===n&&(n=Pa(e,t));var r=t.log,i=0,s=0;n.gate.on(Ba,(function(e){e===yi&&s--})),n.gate.on(Ua,(function(e){e===yi||e===vi?n.isReady()?r.error(en,[e===yi?"SDK_READY":"SDK_READY_TIMED_OUT"]):e===yi&&s++:e===Si&&n.isReadyFromCache()&&r.error(en,["SDK_READY_FROM_CACHE"])}));var o,a=o=xa(new Promise((function(e,t){n.gate.once(yi,(function(){r.info(Xe),s!==i||o.hasOnFulfilled()||r.warn(Ct),e()})),n.gate.once(vi,(function(e){t(new Error(e))}))})),u);function u(e){r.error(e&&e.message)}function c(){return{isReady:n.isReady(),isReadyFromCache:n.isReadyFromCache(),isTimedout:n.isTimedout(),hasTimedout:n.hasTimedout(),isDestroyed:n.isDestroyed(),isOperational:n.isOperational(),lastUpdate:n.lastUpdate()}}return n.gate.once(Si,(function(){r.info(Ze)})),{readinessManager:n,shared:function(){return qa(e,t,n.shared())},incInternalReadyCbCount:function(){i++},sdkStatus:Jn(Object.create(n.gate),{Event:{SDK_READY:yi,SDK_READY_FROM_CACHE:Si,SDK_UPDATE:bi,SDK_READY_TIMED_OUT:vi},ready:function(){return n.hasTimedout()?n.isReady()?Promise.resolve():xa(Promise.reject(new Error("Split SDK has emitted SDK_READY_TIMED_OUT event.")),u):a},whenReady:function(){return new Promise((function(e,t){n.isReady()?e():n.hasTimedout()?t(ja):(n.gate.once(yi,e),n.gate.once(vi,(function(){return t(ja)})))}))},whenReadyFromCache:function(){return new Promise((function(e,t){n.isReadyFromCache()?e(n.isReady()):n.hasTimedout()?t(ja):(n.gate.once(Si,(function(){return e(n.isReady())})),n.gate.once(vi,(function(){return t(ja)})))}))},getStatus:c,__getStatus:c})}}function za(e){function t(t){yr(t)?e.setLogLevel(t):e.error(Xt)}return{enable:function(){t(dr.DEBUG)},setLogLevel:t,setLogger:function(t){e.setLogger(t)},disable:function(){t(dr.NONE)},LogLevel:dr}}var Wa={add:function(){return!0},contains:function(){return!0},clear:function(){}};function Ga(e){var t=e.settings,n=e.platform,r=e.storageFactory,i=e.splitApiFactory,s=e.extraProps,o=e.syncManagerFactory,a=e.SignalListener,u=e.impressionsObserverFactory,c=e.integrationsManagerFactory,l=e.sdkManagerFactory,f=e.sdkClientMethodFactory,h=e.filterAdapterFactory,p=e.lazyInit,g=t.log,d=t.sync.impressionsMode,m=t.initialRolloutPlan,v=t.core.key,y=!1,S=[];function b(e){y?e():S.push(e)}var R=qa(n.EventEmitter,t),k=R.readinessManager,C=r({settings:t,onReadyCb:function(e){e?k.timeout():(k.splits.emit(gi),k.segments.emit(mi))},onReadyFromCacheCb:function(){k.splits.emit(di)}}),w=new uo(t.fallbackTreatments);m&&(or(g,m,C,v&&Kr(v)),C.splits.getChangeNumber()>-1&&k.splits.emit(di));var N,_,A={},I=function(e,t){if(e&&t){var n=Ni(t);return{trackEval:function(n){var r=Ni(t);return function(t){switch(t){case po:return void e.recordException(n);case ho:e.recordNonReadyUsage&&e.recordNonReadyUsage()}e.recordLatency(n,r())}},trackHttp:function(n){var r=Ni(t);return function(t){e.recordHttpLatency(n,r()),t&&t.statusCode?e.recordHttpError(n,t.statusCode):e.recordSuccessfulSync(n,Date.now())}},sessionLength:function(){e.recordSessionLength&&e.recordSessionLength(n())},streamingEvent:function(t,n){t===Se?e.recordAuthRejections():(e.recordStreamingEvents({e:t,d:n,t:Date.now()}),t===me&&e.recordTokenRefreshes())},addTag:function(t){e.addTag&&e.addTag(t)},trackUpdatesFromSSE:function(t){e.recordUpdatesFromSSE(t)}}}var r=function(){return function(){}};return{trackEval:r,trackHttp:r,sessionLength:function(){},streamingEvent:function(){},addTag:function(){},trackUpdatesFromSSE:function(){}}}(C.telemetry,n.now),O=c&&c({settings:t,storage:C,telemetryTracker:I}),F=u(),D=function(e,t,n){var r;return void 0===n&&(n=Wa),{track:function(r,i){n.add(r,i)?t.track(r,i):e.debug(Wn+"The feature "+i+" and key "+r+" exist in the filter")},start:function(){n.refreshRate&&(r=setInterval(n.clear,n.refreshRate))},stop:function(){clearInterval(r)}}}(g,C.uniqueKeys,h&&h()),M=function(e,t){return{process:function(n){var r=Date.now();return e.track(n.feature,r,1),t.track(n.keyName,n.feature),!1}}}(C.impressionCounts,D),K=d===T?(N=F,_=C.impressionCounts,{process:function(e){if(e.properties)return!0;e.pt=N.testAndSet(e);var t=Date.now();return e.pt&&_.track(e.feature,t,1),!e.pt||e.pt<Dr(t)}}):d===E?function(e){return{process:function(t){return t.properties||(t.pt=e.testAndSet(t)),!0}}}(F):M,x=function(e,t,n,r,i,s,o){var a=e.log,u=e.impressionListener,c=e.runtime,l=c.ip,f=c.hostname,h=e.version;return{track:function(c,p){if(e.userConsent!==L){var g=c.filter((function(e){var t=e.imp;return e.disabled?n.process(t):r.process(t)})),d=c.length,m=g.length;if(m){var v=t.track(g.map((function(e){return e.imp})));Hs(v)?v.then((function(){a.info(St,[d])})).catch((function(e){a.error(on,[d,e])})):o&&(o.recordImpressionStats(Q,m),o.recordImpressionStats(J,d-m))}if(u||s)for(var y=function(e){var t={impression:Jn({},c[e].imp),attributes:p,ip:l,hostname:f,sdkLanguageVersion:h};i((function(){setTimeout((function(){s&&s.handleImpression(t);try{u&&u.logImpression(t)}catch(e){a.error(an,[e])}}))}))},S=0;S<d;S++)y(S)}}}}(t,C.impressions,M,K,b,O,C.telemetry),P=function(e,t,n,r,i){var s=e.log,o=Oe(e.mode);function a(e,t){var i=e.eventTypeId,o=e.trafficTypeName,a=e.key,u=e.value,c=e.timestamp,l=e.properties,f='event of type "'+i+'" for traffic type "'+o+'". Key: '+a+". Value: "+u+". Timestamp: "+c+". "+(l?"With properties.":"With no properties.");return t?(s.info(yt,[f]),r&&n((function(){setTimeout((function(){var t=Jn({},e);l&&(t.properties=Jn({},l)),r.handleEvent(t)}))}))):s.error(un,[f]),t}return{track:function(n,r){if(e.userConsent===L)return!!o&&Promise.resolve(!1);var s=t.track(n,r);return Hs(s)?s.then(a.bind(null,n)):(i&&i.recordEventStats(s?Q:V,1),a(n,s))}}}(t,C.events,b,O,C.telemetry),U=i&&i(t,n,I),B={clients:A,splitApi:U,eventTracker:P,impressionsTracker:x,telemetryTracker:I,uniqueKeysTracker:D,sdkReadinessManager:R,readiness:k,settings:t,storage:C,platform:n,fallbackTreatmentsCalculator:w},j=o&&o(B);B.syncManager=j;var q=a&&new a(j,t,C,U);B.signalListener=q;var z=f(B),W=l(t,C.splits,R);function G(){y||(y=!0,wi(g,t.core.authorizationKey),k.init(),D.start(),j&&j.start(),q&&q.start(),S.forEach((function(e){return e()})),S.length=0)}return g.info(rt,[t.version]),Jn({client:z,manager:function(){return g.debug(Be),W},Logger:za(g),settings:t,destroy:function(){return y=!1,Promise.all(Object.keys(A).map((function(e){return A[e].destroy()}))).then((function(){}))}},s&&s(B),p?{init:G}:G())}function Ha(e,t){return t=t||{},new Promise((function(n,r){var i=new XMLHttpRequest,s=[],o=[],a={},u=function(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:u,headers:{keys:function(){return s},entries:function(){return o},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(var c in i.open(t.method||"get",e,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,n){s.push(t=t.toLowerCase()),o.push([t,n]),a[t]=a[t]?a[t]+","+n:n})),n(u())},i.onerror=r,i.withCredentials="include"==t.credentials,t.headers)i.setRequestHeader(c,t.headers[c]);i.send(t.body||null)}))}var Qa="object"==typeof Reflect?Reflect:null,Va=Qa&&"function"==typeof Qa.apply?Qa.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},Ja=function e(){e.init.call(this)};function Ya(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function $a(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}Ja.prototype._events=void 0,Ja.prototype._eventsCount=0,Ja.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0)},Ja.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=i[e];if(void 0===a)return!1;if("function"==typeof a)Va(a,this,t);else for(var u=a.length,c=function(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}(a,u),l=0;l<u;++l)Va(c[l],this,t);return!0},Ja.prototype.addListener=function(e,t){return function(e,t,n,r){var i,s;return Ya(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s?(s=i[t]=n,++e._eventsCount):"function"==typeof s?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),e}(this,e,t,!1)},Ja.prototype.on=Ja.prototype.addListener,Ja.prototype.once=function(e,t){return Ya(t),this.on(e,function(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=$a.bind(r);return i.listener=n,r.wrapFn=i,i}(this,e,t)),this},Ja.prototype.removeListener=function(e,t){var n,r,i,s,o;if(Ya(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},Ja.prototype.off=Ja.prototype.removeListener,Ja.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this};var Za={getFetch:function(){return"function"==typeof fetch?fetch:Ha},getEventSource:function(){return"function"==typeof EventSource?EventSource:void 0},EventEmitter:Ja,now:"object"==typeof performance&&"function"==typeof performance.now?performance.now.bind(performance):Date.now};function Xa(e,t){var n=function(e){return pr(e,Yr)}(e),r=function(e,t){Da||(Da=Yi(Gs,xs));var n={settings:e,platform:t,storageFactory:e.storage,splitApiFactory:ii,syncManagerFactory:Da,sdkManagerFactory:Co,sdkClientMethodFactory:da,SignalListener:Sa,integrationsManagerFactory:e.integrations&&e.integrations.length>0?Na.bind(null,e.integrations):void 0,impressionsObserverFactory:wa,extraProps:function(e){return{UserConsent:Aa(e)}}};switch(e.mode){case k:n.splitApiFactory=void 0,n.syncManagerFactory=Ka,n.SignalListener=void 0;break;case N:n.syncManagerFactory=void 0;break;case _:Ma||(Ma=Yi(void 0,void 0)),n.syncManagerFactory=Ma}return n}(n,Za);return t&&t(r),Ga(r)}var eu=/[^.]+$/;var tu=function(e){function n(t,n){var r=e.call(this,t)||this;return r.matchingKey=n,r.regexSplitsCacheKey=new RegExp("^"+t+"\\.(splits?|trafficType|flagSet)\\."),r}return t(n,e),n.prototype.buildSegmentNameKey=function(e){return this.prefix+"."+this.matchingKey+".segment."+e},n.prototype.extractSegmentName=function(e){var t=this.prefix+"."+this.matchingKey+".segment.";if(g(e,t))return e.slice(t.length)},n.prototype.buildLastUpdatedKey=function(){return this.prefix+".splits.lastUpdated"},n.prototype.isSplitsCacheKey=function(e){return this.regexSplitsCacheKey.test(e)},n.prototype.buildTillKey=function(){return this.prefix+"."+this.matchingKey+".segments.till"},n.prototype.isSplitKey=function(e){return g(e,this.prefix+".split.")},n.prototype.isRBSegmentKey=function(e){return g(e,this.prefix+".rbsegment.")},n.prototype.buildSplitsWithSegmentCountKey=function(){return this.prefix+".splits.usingSegments"},n.prototype.buildLastClear=function(){return this.prefix+".lastClear"},n}(function(){function e(e){void 0===e&&(e="SPLITIO"),this.prefix=e}return e.prototype.buildTrafficTypeKey=function(e){return this.prefix+".trafficType."+e},e.prototype.buildFlagSetKey=function(e){return this.prefix+".flagSet."+e},e.prototype.buildSplitKey=function(e){return this.prefix+".split."+e},e.prototype.buildSplitsTillKey=function(){return this.prefix+".splits.till"},e.prototype.buildSplitKeyPrefix=function(){return this.prefix+".split."},e.prototype.buildRBSegmentKey=function(e){return this.prefix+".rbsegment."+e},e.prototype.buildRBSegmentsTillKey=function(){return this.prefix+".rbsegments.till"},e.prototype.buildRBSegmentKeyPrefix=function(){return this.prefix+".rbsegment."},e.prototype.buildSegmentNameKey=function(e){return this.prefix+".segment."+e},e.prototype.buildSegmentTillKey=function(e){return this.prefix+".segment."+e+".till"},e.prototype.extractKey=function(e){var t=e.match(eu);if(t&&t.length)return t[0];throw new Error("Invalid latency key provided")},e.prototype.buildHashKey=function(){return this.prefix+".hash"},e}());function nu(e,t){return{buildSegmentNameKey:function(n){return e+"."+t+".largeSegment."+n},extractSegmentName:function(n){var r=e+"."+t+".largeSegment.";if(g(n,r))return n.slice(r.length)},buildTillKey:function(){return e+"."+t+".largeSegments.till"}}}var ru="storage:localstorage: ",iu="1",su=function(e){function n(t,n,r){var i=e.call(this)||this;return i.keys=n,i.log=t.log,i.flagSetsFilter=t.sync.__splitFiltersValidation.groupedFilters.bySet,i.storage=r,i}return t(n,e),n.prototype._decrementCount=function(e){var t=d(this.storage.getItem(e))-1;t>0?this.storage.setItem(e,t+""):this.storage.removeItem(e)},n.prototype._decrementCounts=function(e){try{var t=this.keys.buildTrafficTypeKey(e.trafficTypeName);if(this._decrementCount(t),wr(e)){var n=this.keys.buildSplitsWithSegmentCountKey();this._decrementCount(n)}}catch(e){this.log.error(ru+e)}},n.prototype._incrementCounts=function(e){try{var t=this.keys.buildTrafficTypeKey(e.trafficTypeName);if(this.storage.setItem(t,d(this.storage.getItem(t))+1+""),wr(e)){var n=this.keys.buildSplitsWithSegmentCountKey();this.storage.setItem(n,d(this.storage.getItem(n))+1+"")}}catch(e){this.log.error(ru+e)}},n.prototype.clear=function(){for(var e=this,t=this.storage.length,n=[],r=0;r<t;r++){var i=this.storage.key(r);null!=i&&this.keys.isSplitsCacheKey(i)&&n.push(i)}n.forEach((function(t){e.storage.removeItem(t)})),this.hasSync=!1},n.prototype.addSplit=function(e){var t=e.name,n=this.keys.buildSplitKey(t),r=this.storage.getItem(n),i=r?JSON.parse(r):null;return i&&(this._decrementCounts(i),this.removeFromFlagSets(i.name,i.sets)),this.storage.setItem(n,JSON.stringify(e)),this._incrementCounts(e),this.addToFlagSets(e),!0},n.prototype.removeSplit=function(e){var t=this.getSplit(e);return!!t&&(this.storage.removeItem(this.keys.buildSplitKey(e)),this._decrementCounts(t),this.removeFromFlagSets(t.name,t.sets),!0)},n.prototype.getSplit=function(e){var t=this.storage.getItem(this.keys.buildSplitKey(e));return t&&JSON.parse(t)},n.prototype.setChangeNumber=function(e){try{return this.storage.setItem(this.keys.buildSplitsTillKey(),e+""),this.storage.setItem(this.keys.buildLastUpdatedKey(),Date.now()+""),this.hasSync=!0,!0}catch(e){return this.log.error(ru+e),!1}},n.prototype.getChangeNumber=function(){var e=this.storage.getItem(this.keys.buildSplitsTillKey());return null!==e?c(e=parseInt(e,10))?-1:e:-1},n.prototype.getSplitNames=function(){for(var e=this.storage.length,t=[],n=0;n<e;){var r=this.storage.key(n);null!=r&&this.keys.isSplitKey(r)&&t.push(this.keys.extractKey(r)),n++}return t},n.prototype.trafficTypeExists=function(e){var t=d(this.storage.getItem(this.keys.buildTrafficTypeKey(e)));return u(t)&&t>0},n.prototype.usesSegments=function(){if(!this.hasSync)return!0;var e=this.storage.getItem(this.keys.buildSplitsWithSegmentCountKey()),t=null===e?0:d(e);return!u(t)||t>0},n.prototype.getNamesByFlagSets=function(e){var t=this;return e.map((function(e){var n=t.keys.buildFlagSetKey(e),r=t.storage.getItem(n);return new Set(r?JSON.parse(r):[])}))},n.prototype.addToFlagSets=function(e){var t=this;e.sets&&e.sets.forEach((function(n){if(!(t.flagSetsFilter.length>0)||t.flagSetsFilter.some((function(e){return e===n}))){var r=t.keys.buildFlagSetKey(n),i=t.storage.getItem(r),s=new Set(i?JSON.parse(i):[]);s.has(e.name)||(s.add(e.name),t.storage.setItem(r,JSON.stringify(zr(s))))}}))},n.prototype.removeFromFlagSets=function(e,t){var n=this;t&&t.forEach((function(t){n.removeNames(t,e)}))},n.prototype.removeNames=function(e,t){var n=this.keys.buildFlagSetKey(e),r=this.storage.getItem(n);if(r){var i=new Set(JSON.parse(r));i.delete(t),0!==i.size?this.storage.setItem(n,JSON.stringify(zr(i))):this.storage.removeItem(n)}},n}(Cr),ou=function(){function e(e,t,n){this.keys=t,this.log=e.log,this.storage=n}return e.prototype.clear=function(){var e=this;this.getNames().forEach((function(t){return e.remove(t)})),this.storage.removeItem(this.keys.buildRBSegmentsTillKey())},e.prototype.update=function(e,t,n){var r=this,i=e.map((function(e){return r.add(e)})).some((function(e){return e}));return i=t.map((function(e){return r.remove(e.name)})).some((function(e){return e}))||i,this.setChangeNumber(n),i},e.prototype.setChangeNumber=function(e){try{this.storage.setItem(this.keys.buildRBSegmentsTillKey(),e+""),this.storage.setItem(this.keys.buildLastUpdatedKey(),Date.now()+"")}catch(e){this.log.error(ru+e)}},e.prototype.updateSegmentCount=function(e){var t=this.keys.buildSplitsWithSegmentCountKey(),n=d(this.storage.getItem(t))+e;n>0?this.storage.setItem(t,n+""):this.storage.removeItem(t)},e.prototype.add=function(e){var t=e.name,n=this.keys.buildRBSegmentKey(t),r=this.storage.getItem(n),i=r?JSON.parse(r):null;this.storage.setItem(n,JSON.stringify(e));var s=0;return i&&wr(i)&&s--,wr(e)&&s++,0!==s&&this.updateSegmentCount(s),!0},e.prototype.remove=function(e){var t=this.get(e);return!!t&&(this.storage.removeItem(this.keys.buildRBSegmentKey(e)),wr(t)&&this.updateSegmentCount(-1),!0)},e.prototype.getNames=function(){for(var e=this.storage.length,t=[],n=0;n<e;){var r=this.storage.key(n);null!=r&&this.keys.isRBSegmentKey(r)&&t.push(this.keys.extractKey(r)),n++}return t},e.prototype.get=function(e){var t=this.storage.getItem(this.keys.buildRBSegmentKey(e));return t&&JSON.parse(t)},e.prototype.getAll=function(){var e=this;return this.getNames().map((function(t){return e.get(t)}))},e.prototype.contains=function(e){var t=zr(e),n=this.getNames();return t.every((function(e){return-1!==n.indexOf(e)}))},e.prototype.getChangeNumber=function(){var e=this.storage.getItem(this.keys.buildRBSegmentsTillKey());return null!==e?c(e=parseInt(e,10))?-1:e:-1},e.prototype.usesSegments=function(){var e=this.storage.getItem(this.keys.buildSplitsWithSegmentCountKey()),t=null===e?0:d(e);return!u(t)||t>0},e}(),au=function(e){function n(t,n,r){var i=e.call(this)||this;return i.log=t,i.keys=n,i.storage=r,i}return t(n,e),n.prototype.addSegment=function(e){var t=this.keys.buildSegmentNameKey(e);return this.storage.getItem(t)!==iu&&(this.storage.setItem(t,iu),!0)},n.prototype.removeSegment=function(e){var t=this.keys.buildSegmentNameKey(e);return this.storage.getItem(t)===iu&&(this.storage.removeItem(t),!0)},n.prototype.isInSegment=function(e){return this.storage.getItem(this.keys.buildSegmentNameKey(e))===iu},n.prototype.getRegisteredSegments=function(){for(var e=[],t=0,n=this.storage.length;t<n;t++){var r=this.keys.extractSegmentName(this.storage.key(t));r&&e.push(r)}return e},n.prototype.getKeysCount=function(){return 1},n.prototype.setChangeNumber=function(e){e?this.storage.setItem(this.keys.buildTillKey(),e+""):this.storage.removeItem(this.keys.buildTillKey())},n.prototype.getChangeNumber=function(){var e=this.storage.getItem(this.keys.buildTillKey());return null!==e?c(e=parseInt(e,10))?-1:e:-1},n}(Ar),uu=10,cu=864e5;function lu(e,t,n,r,i,s){var o=n.log,a=n.initialRolloutPlan,l=parseInt(t.getItem(r.buildLastUpdatedKey()),10);if(!c(l)){var f=u(e.expirationDays)&&e.expirationDays>=1?e.expirationDays:uu;if(l<i-cu*f)return o.info(ru+"Cache expired more than "+f+" days ago. Cleaning up cache"),!0}var h=r.buildHashKey(),p=t.getItem(h),g=function(e){return gs(e.core.authorizationKey+"::"+e.sync.__splitFiltersValidation.queryString+"::"+e.sync.flagSpecVersion).toString(16)}(n);if(p!==g){try{t.setItem(h,g)}catch(e){o.error(ru+e)}return!(!s||a)&&(o.info(ru+"SDK key, flags filter criteria, or flags spec version has changed. Cleaning up cache"),!0)}if(e.clearOnInit){var d=parseInt(t.getItem(r.buildLastClear()),10);if(c(d)||d<i-cu)return o.info(ru+"clearOnInit was set and cache was not cleared in the last 24 hours. Cleaning up cache"),!0}}function fu(e,t,n){if(n){if(function(e){return null!==e&&"object"==typeof e&&"function"==typeof e.setItem&&"function"==typeof e.getItem&&"function"==typeof e.removeItem}(n))return function(e){if("number"==typeof e.length)try{return e.key(0),!0}catch(e){return!1}return!1}(n)?n:function(e,t,n){var r,i=[],s={},o=Promise.resolve();return{load:function(){return r||(r=Promise.resolve().then((function(){return n.getItem(t)})).then((function(e){s=JSON.parse(e||"{}"),i=Object.keys(s)})).catch((function(t){e.error(ru+"Error calling wrapper `getItem` method: "+t)})))},save:function(){return o=o.then((function(){return Promise.resolve(n.setItem(t,JSON.stringify(s)))})).catch((function(t){e.error(ru+"Error calling wrapper `setItem` method: "+t)}))},whenSaved:function(){return o},get length(){return i.length},getItem:function(e){return s[e]||null},key:function(e){return i[e]||null},removeItem:function(e){var t=i.indexOf(e);-1!==t&&(i.splice(t,1),delete s[e])},setItem:function(e,t){-1===i.indexOf(e)&&i.push(e),s[e]=t}}}(e,t,n);e.warn(ru+"Invalid storage provided. Falling back to LocalStorage API")}if(function(){var e="__SPLITSOFTWARE__";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}())return localStorage;e.warn(ru+"LocalStorage API is unavailable. Falling back to default MEMORY storage")}var hu=[[Zt,On+"Invalid feature flag, no valid rules or unsupported targeting rule type found"],[wn,Fn+"[%s] %s"],[Xt,"logger: Invalid Log Level - No changes to the logs will be applied."],[tn,"The SDK will not get ready. Reason: %s"],[on,qn+"Could not store impressions bulk with %s impression(s). Error: %s"],[an,qn+"Impression listener logImpression method threw: %s."],[un,zn+"Failed to queue %s"],[nn,Kn+"There was an issue loading the mock feature flags data. No changes will be applied to the current cache. %s"],[rn,xn+"Failed to connect or error on streaming connection, with error message: %s"],[sn,xn+"Failed to authenticate for streaming. Error: %s."],[En,"HTTP request failed with %s. URL: %s. Message: %s"],[en,"A listener was added for %s on the SDK, which has already fired and won't be emitted again. The callback won't be executed."],[pn,"%s: Client has already been destroyed - no calls possible."],[cn,'%s: you passed "%s", event_type must adhere to the regular expression /^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/g. This means an event_type must be alphanumeric, cannot be more than 80 characters long, and can only include a dash, underscore, period, or colon as separators of alphanumeric characters.'],[ln,"%s: %s must be a plain object."],[fn,"%s: the maximum size allowed for the properties is 32768 bytes, which was exceeded."],[hn,"%s: value must be a finite number."],[gn,"%s: you passed a null or undefined %s. It must be a non-empty string."],[dn,"%s: %s too long. It must have 250 characters or less."],[mn,"%s: Key must be an object with bucketingKey and matchingKey with valid string properties."],[vn,"%s: you passed an invalid %s. It must be a non-empty string."],[yn,"%s: you passed an empty %s. It must be a non-empty string."],[Sn,"%s: %s must be a non-empty array."],[Tn,"%s: provided param must be a boolean value."],[bn,Nn+': you passed an invalid "%s" config param. It should be one of the following values: %s. Defaulting to "%s".'],[324,Nn+": the provided storage is invalid.%s Falling back into default MEMORY storage"],[Rn,Nn+': the provided "%s" config param is lower than allowed. Setting to the minimum value %s seconds'],[kn,Nn+": the amount of flag sets provided are big causing uri length error."],[Cn,Nn+": the Set filter is exclusive and cannot be used simultaneously with names or prefix filters. Ignoring names and prefixes."]];var pu=hu.concat([[Rt,Ln+"Value %s doesn't match with expected type."],[kt,Ln+"Defined attribute `%s`. No attributes received."],[Nt,Un+"Retrying fetch of memberships (attempt #%s). Reason: %s"],[_t,Pn+"Error while doing fetch of feature flags. %s"],[At,xn+"Error parsing SSE error notification: %s"],[It,xn+"Error parsing SSE message notification: %s"],[Ot,xn+"Falling back to polling mode. Reason: %s"],[Ft,jn+"Dropping %s after retry. Reason: %s."],[Lt,jn+"Failed to push %s, keeping data to retry on next iteration. Reason: %s."],[wt,"%s: the SDK is not ready to evaluate. Results may be incorrect%s. Make sure to wait for SDK readiness before using this method."],[Ct,"No listeners for SDK_READY event detected. Incorrect control treatments could have been logged if you called getTreatment/s while the SDK was not yet synchronized with the backend."],[Dt,'%s: Property "%s" is of invalid type. Setting value to null.'],[Mt,"%s: more than 300 properties were provided. Some of them will be trimmed when processed."],[Kt,'%s: %s "%s" is not of type string, converting.'],[xt,'%s: %s "%s" has extra whitespace, trimming.'],[Pt,'%s: feature flag "%s" does not exist in this environment. Please double check what feature flags exist in the Split user interface.'],[Ut,"%s: traffic_type_name should be all lowercase - converting string to lowercase."],[Bt,'%s: traffic type "%s" does not have any corresponding feature flag in this environment, make sure you\'re tracking your events to a valid traffic type defined in the Split user interface.'],[Yt,"%s: you passed %s which is not part of the configured FlagSetsFilter, ignoring Flag Set."],[jt,Nn+": %s integration item(s) at settings is invalid. %s"],[qt,Nn+": feature flag filters are not applicable for Consumer modes where the SDK does not keep rollout data in sync. Filters were discarded"],[zt,Nn+': feature flag filter at position %s is invalid. It must be an object with a valid filter type ("bySet", "byName" or "byPrefix") and a list of "values".'],[Wt,Nn+": feature flag filter configuration must be a non-empty array of filter objects."],[Gt,Nn+": You already have %s. We recommend keeping only one instance of the factory at all times (Singleton pattern) and reusing it throughout your application"],[Ht,xn+"Fetching Memberships due to an error processing %s notification: %s"],[Qt,xn+"Fetching SplitChanges due to an error processing %s notification: %s"],[Vt,"%s: you passed %s, flag set must adhere to the regular expressions %s. This means a flag set must start with a letter or number, be in lowercase, alphanumeric and have a max length of 50 characters. %s was discarded."],[Jt,"%s: flag set %s should be all lowercase - converting string to lowercase."],[$t,"%s: you passed %s flag set that does not contain cached feature flag names. Please double check what flag sets are in use in the Split user interface."]]);var gu="Split SDK client is ready",du=pu.concat([[Ze,gu+" from cache"],[Xe,gu],[et,qn+"Feature flag: %s. Key: %s. Evaluation: %s. Label: %s"],[tt,qn+"Queueing corresponding impression."],[nt,"New shared client instance created."],[rt,"New Split SDK instance created. %s"],[yt,zn+"Successfully queued %s"],[St,qn+"Successfully stored %s impression(s)."],[bt,"UserConsent: consent status changed from %s to %s."],[Et,"UserConsent: call had no effect because it was the current consent status (%s)."],[Tt,"Starting the SDK with %s user consent. No data will be sent."],[it,Bn+"Turning segments data polling %s."],[st,Bn+"Starting polling"],[ot,Bn+"Stopping polling"],[at,Pn+"Retrying fetch of feature flags (attempt #%s). Reason: %s"],[pt,jn+"Flushing full %s queue and resetting timer."],[gt,jn+"Pushing %s."],[125,jn+"Flushing %s because page became hidden."],[ut,xn+"Refreshing streaming token in %s seconds, and connecting streaming in %s seconds."],[ct,xn+"Attempting to reconnect streaming in %s seconds."],[lt,xn+"Connecting streaming."],[ft,xn+"Streaming is disabled for given SDK key. Switching to polling mode."],[ht,xn+"Disconnecting streaming."],[dt,Mn+"Streaming not available. Starting polling."],[mt,Mn+"Streaming couldn't connect. Continue polling."],[vt,Mn+"Streaming connected. Syncing and stopping polling."]]);var mu=du.concat([[Fe,On+"[andCombiner] evaluates to %s"],[Le,On+"Treatment found: %s"],[De,On+"All predicates evaluated, no treatment found."],[Me,In+': using algo "murmur" bucket %s for key %s using seed %s - treatment %s'],[10,Fn+'[IN_SPLIT_TREATMENT] parent feature flag "%s" evaluated to "%s" with label "%s". %s evaluated treatment is part of %s ? %s.'],[11,Fn+'[IN_SPLIT_TREATMENT] will evaluate parent feature flag: "%s" with key: %s %s'],[Ke,Ln+"Extracted attribute `%s`. %s will be used for matching."],[xe,In+":sanitize: Attempted to sanitize %s which should be of type %s. Sanitized and processed value => %s"],[Ye,Fn+"[%s] Result: %s. Rule value: %s. Evaluation value: %s"],[$e,In+"Evaluates to default treatment. %s"],[25,Gn+"Registering cleanup handler %s"],[26,Gn+"Deregistering cleanup handler %s"],[Pe,"Retrieving default SDK client."],[Ue,"Retrieving existing SDK client."],[Be,"Retrieving manager instance."],[je,Kn+"Feature flags data: \n%s"],[qe,Pn+"Spin up feature flags update using since = %s and rbSince = %s."],[ze,Pn+"New feature flags: %s. Removed feature flags: %s."],[We,Pn+"New rule-based segments: %s. Removed rule-based segments: %s."],[Ge,xn+"New SSE message received, with data: %s."],[He,Dn+": Starting %s. Running each %s millis"],[Qe,Dn+": Running %s"],[Ve,Dn+": Stopping %s"],[Je,Nn+': feature flags filtering criteria is "%s".']]);return Xa.SplitFactory=Xa,Xa.InLocalStorage=function(e){void 0===e&&(e={});var t=function(e){return e?e+".SPLITIO":"SPLITIO"}(e.prefix);function n(n){var r=n.settings,i=n.settings,s=i.log,o=i.scheduler,a=o.impressionsQueueSize,u=o.eventsQueueSize,c=fu(s,t,e.wrapper);if(!c)return Hr(n);var l,f=Kr(r.core.key),h=new tu(t,f),p=new su(r,h,c),g=new ou(r,h,c),d=new au(s,h,c),m=new au(s,nu(t,f),c);return{splits:p,rbSegments:g,segments:d,largeSegments:m,impressions:new Or(a),impressionCounts:new Mr,events:new Fr(u),telemetry:jr(n)?new qr(p,d):void 0,uniqueKeys:new Wr,validateCache:function(){return l||(l=function(e,t,n,r,i,s,o,a){return Promise.resolve(t.load&&t.load()).then((function(){var u=Date.now(),c=i.getChangeNumber()>-1;if(lu(e,t,n,r,u,c)){i.clear(),s.clear(),o.clear(),a.clear();try{t.setItem(r.buildLastClear(),u+"")}catch(e){n.log.error(ru+e)}return t.save&&t.save(),!1}return c}))}(e,c,r,h,p,g,d,m))},save:function(){return c.save&&c.save()},destroy:function(){return c.whenSaved&&c.whenSaved()},shared:function(e){return{splits:this.splits,rbSegments:this.rbSegments,segments:new au(s,new tu(t,e),c),largeSegments:new au(s,nu(t,e),c),impressions:this.impressions,impressionCounts:this.impressionCounts,events:this.events,telemetry:this.telemetry,uniqueKeys:this.uniqueKeys,destroy:function(){}}}}}return n.type=I,n},Xa.ErrorLogger=function(){return new Tr({logLevel:"ERROR"},new Map(hu))},Xa.WarnLogger=function(){return new Tr({logLevel:"WARN"},new Map(pu))},Xa.InfoLogger=function(){return new Tr({logLevel:"INFO"},new Map(du))},Xa.DebugLogger=function(){return new Tr({logLevel:"DEBUG"},new Map(mu))},Xa}));